!function(e){e.fn.slide=function(t){return e.fn.slide.defaults={type:"slide",effect:"fade",autoPlay:!1,delayTime:500,interTime:2500,triggerTime:150,defaultIndex:0,titCell:".hd li",mainCell:".bd",targetCell:null,trigger:"mouseover",scroll:1,vis:1,titOnClassName:"on",autoPage:!1,prevCell:".prev",nextCell:".next",pageStateCell:".pageState",opp:!1,pnLoop:!0,easing:"swing",startFun:null,endFun:null,switchLoad:null,playStateCell:".playState",mouseOverStop:!0,defaultPlay:!0,returnDefault:!1},this.each(function(){var a,n=e.extend({},e.fn.slide.defaults,t),i=e(this),o=n.effect,s=e(n.prevCell,i),r=e(n.nextCell,i),c=e(n.pageStateCell,i),l=e(n.playStateCell,i),d=e(n.titCell,i),u=d.length,f=e(n.mainCell,i),h=f.children().length,p=n.switchLoad,m=e(n.targetCell,i),v=parseInt(n.defaultIndex),g=parseInt(n.delayTime),w=parseInt(n.interTime),b=(parseInt(n.triggerTime),parseInt(n.scroll)),C=parseInt(n.vis),$="false"!=n.autoPlay&&0!=n.autoPlay,k="false"!=n.opp&&0!=n.opp,y="false"!=n.autoPage&&0!=n.autoPage,I="false"!=n.pnLoop&&0!=n.pnLoop,M="false"!=n.mouseOverStop&&0!=n.mouseOverStop,j="false"!=n.defaultPlay&&0!=n.defaultPlay,x="false"!=n.returnDefault&&0!=n.returnDefault,S=0,T=0,q=0,P=0,_=n.easing,O=null,Q=null,L=null,E=n.titOnClassName,D=d.index(i.find("."+E)),F=v=-1==D?v:D,H=v,z=v,B=h>=C?h%b!=0?h%b:b:0,N="leftMarquee"==o||"topMarquee"==o,R=function(){e.isFunction(n.startFun)&&n.startFun(v,u,i,e(n.titCell,i),f,m,s,r)},A=function(){e.isFunction(n.endFun)&&n.endFun(v,u,i,e(n.titCell,i),f,m,s,r)},W=function(){d.removeClass(E),j&&d.eq(H).addClass(E)};if("menu"==n.type)return j&&d.removeClass(E).eq(v).addClass(E),d.hover(function(){a=e(this).find(n.targetCell);var t=d.index(e(this));Q=setTimeout(function(){switch(v=t,d.removeClass(E).eq(v).addClass(E),R(),o){case"fade":a.stop(!0,!0).animate({opacity:"show"},g,_,A);break;case"slideDown":a.stop(!0,!0).animate({height:"show"},g,_,A)}},n.triggerTime)},function(){switch(clearTimeout(Q),o){case"fade":a.animate({opacity:"hide"},g,_);break;case"slideDown":a.animate({height:"hide"},g,_)}}),void(x&&i.hover(function(){clearTimeout(L)},function(){L=setTimeout(W,g)}));if(0==u&&(u=h),N&&(u=2),y){if(h>=C)if("leftLoop"==o||"topLoop"==o)u=h%b!=0?1+(h/b^0):h/b;else{var J=h-C;u=1+parseInt(J%b!=0?J/b+1:J/b),u<=0&&(u=1)}else u=1;d.html("");var U="";if(1==n.autoPage||"true"==n.autoPage)for(var G=0;G<u;G++)U+="<li>"+(G+1)+"</li>";else for(var G=0;G<u;G++)U+=n.autoPage.replace("$",G+1);d.html(U);var d=d.children()}if(h>=C){f.children().each(function(){e(this).width()>q&&(q=e(this).width(),T=e(this).outerWidth(!0)),e(this).height()>P&&(P=e(this).height(),S=e(this).outerHeight(!0))});var V=f.children(),Y=function(){for(var e=0;e<C;e++)V.eq(e).clone().addClass("clone").appendTo(f);for(var e=0;e<B;e++)V.eq(h-e-1).clone().addClass("clone").prependTo(f)};switch(o){case"fold":f.css({position:"relative",width:T,height:S}).children().css({position:"absolute",width:q,left:0,top:0,display:"none"});break;case"top":f.wrap('<div class="tempWrap" style="overflow:hidden; position:relative; height:'+C*S+'px"></div>').css({top:-v*b*S,position:"relative",padding:"0",margin:"0"}).children().css({height:P});break;case"left":f.wrap('<div class="tempWrap" style="overflow:hidden; position:relative; width:'+C*T+'px"></div>').css({width:h*T,left:-v*b*T,position:"relative",overflow:"hidden",padding:"0",margin:"0"}).children().css({"float":"left",width:q});break;case"leftLoop":case"leftMarquee":Y(),f.wrap('<div class="tempWrap" style="overflow:hidden; position:relative; width:'+C*T+'px"></div>').css({width:(h+C+B)*T,position:"relative",overflow:"hidden",padding:"0",margin:"0",left:-(B+v*b)*T}).children().css({"float":"left",width:q});break;case"topLoop":case"topMarquee":Y(),f.wrap('<div class="tempWrap" style="overflow:hidden; position:relative; height:'+C*S+'px"></div>').css({height:(h+C+B)*S,position:"relative",padding:"0",margin:"0",top:-(B+v*b)*S}).children().css({height:P})}}var X=function(e){var t=e*b;return e==u?t=h:-1==e&&h%b!=0&&(t=-h%b),t},K=function(t){var a=function(a){for(var n=a;n<C+a;n++)t.eq(n).find("img["+p+"]").each(function(){var t=e(this);if(t.attr("src",t.attr(p)).removeAttr(p),f.find(".clone")[0])for(var a=f.children(),n=0;n<a.length;n++)a.eq(n).find("img["+p+"]").each(function(){e(this).attr(p)==t.attr("src")&&e(this).attr("src",e(this).attr(p)).removeAttr(p)})})};switch(o){case"fade":case"fold":case"top":case"left":case"slideDown":a(v*b);break;case"leftLoop":case"topLoop":a(B+X(z));break;case"leftMarquee":case"topMarquee":var n="leftMarquee"==o?f.css("left").replace("px",""):f.css("top").replace("px",""),i="leftMarquee"==o?T:S,s=B;if(n%i!=0){var r=Math.abs(n/i^0);s=1==v?B+r:B+r-1}a(s)}},Z=function(e){if(!j||F!=v||e||N){if(N?v>=1?v=1:v<=0&&(v=0):(z=v,v>=u?v=0:v<0&&(v=u-1)),R(),null!=p&&K(f.children()),m[0]&&(a=m.eq(v),null!=p&&K(m),"slideDown"==o?(m.not(a).stop(!0,!0).slideUp(g),a.slideDown(g,_,function(){f[0]||A()})):(m.not(a).stop(!0,!0).hide(),a.animate({opacity:"show"},g,function(){f[0]||A()}))),h>=C)switch(o){case"fade":f.children().stop(!0,!0).eq(v).animate({opacity:"show"},g,_,function(){A()}).siblings().hide();break;case"fold":f.children().stop(!0,!0).eq(v).animate({opacity:"show"},g,_,function(){A()}).siblings().animate({opacity:"hide"},g,_);break;case"top":f.stop(!0,!1).animate({top:-v*b*S},g,_,function(){A()});break;case"left":f.stop(!0,!1).animate({left:-v*b*T},g,_,function(){A()});break;case"leftLoop":var t=z;f.stop(!0,!0).animate({left:-(X(z)+B)*T},g,_,function(){t<=-1?f.css("left",-(B+(u-1)*b)*T):t>=u&&f.css("left",-B*T),A()});break;case"topLoop":var t=z;f.stop(!0,!0).animate({top:-(X(z)+B)*S},g,_,function(){t<=-1?f.css("top",-(B+(u-1)*b)*S):t>=u&&f.css("top",-B*S),A()});break;case"leftMarquee":var n=f.css("left").replace("px","");0==v?f.animate({left:++n},0,function(){f.css("left").replace("px","")>=0&&f.css("left",-h*T)}):f.animate({left:--n},0,function(){f.css("left").replace("px","")<=-(h+B)*T&&f.css("left",-B*T)});break;case"topMarquee":var i=f.css("top").replace("px","");0==v?f.animate({top:++i},0,function(){f.css("top").replace("px","")>=0&&f.css("top",-h*S)}):f.animate({top:--i},0,function(){f.css("top").replace("px","")<=-(h+B)*S&&f.css("top",-B*S)})}d.removeClass(E).eq(v).addClass(E),F=v,I||(r.removeClass("nextStop"),s.removeClass("prevStop"),0==v&&s.addClass("prevStop"),v==u-1&&r.addClass("nextStop")),c.html("<span>"+(v+1)+"</span>/"+u)}};j&&Z(!0),x&&i.hover(function(){clearTimeout(L)},function(){L=setTimeout(function(){v=H,j?Z():"slideDown"==o?a.slideUp(g,W):a.animate({opacity:"hide"},g,W),F=v},300)});var ee=function(e){O=setInterval(function(){k?v--:v++,Z()},e||w)},te=function(e){O=setInterval(Z,e||w)},ae=function(){M||(clearInterval(O),ee())},ne=function(){(I||v!=u-1)&&(v++,Z(),N||ae())},ie=function(){(I||0!=v)&&(v--,Z(),N||ae())},oe=function(){clearInterval(O),N?te():ee(),l.removeClass("pauseState")},se=function(){clearInterval(O),l.addClass("pauseState")};if($?N?(k?v--:v++,te(),M&&f.hover(se,oe)):(ee(),M&&i.hover(se,oe)):(N&&(k?v--:v++),l.addClass("pauseState")),l.click(function(){l.hasClass("pauseState")?oe():se()}),"mouseover"==n.trigger?d.hover(function(){var e=d.index(this);Q=setTimeout(function(){v=e,Z(),ae()},n.triggerTime)},function(){clearTimeout(Q)}):d.click(function(){v=d.index(this),Z(),ae()}),N){if(r.mousedown(ne),s.mousedown(ie),I){var re,ce=function(){re=setTimeout(function(){clearInterval(O),te(w/10^0)},150)},le=function(){clearTimeout(re),clearInterval(O),te()};r.mousedown(ce),r.mouseup(le),s.mousedown(ce),s.mouseup(le)}"mouseover"==n.trigger&&(r.hover(ne,function(){}),s.hover(ie,function(){}))}else r.click(ne),s.click(ie)})}}(jQuery),jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,a,n,i){return jQuery.easing[jQuery.easing.def](e,t,a,n,i)},easeInQuad:function(e,t,a,n,i){return n*(t/=i)*t+a},easeOutQuad:function(e,t,a,n,i){return-n*(t/=i)*(t-2)+a},easeInOutQuad:function(e,t,a,n,i){return(t/=i/2)<1?n/2*t*t+a:-n/2*(--t*(t-2)-1)+a},easeInCubic:function(e,t,a,n,i){return n*(t/=i)*t*t+a},easeOutCubic:function(e,t,a,n,i){return n*((t=t/i-1)*t*t+1)+a},easeInOutCubic:function(e,t,a,n,i){return(t/=i/2)<1?n/2*t*t*t+a:n/2*((t-=2)*t*t+2)+a},easeInQuart:function(e,t,a,n,i){return n*(t/=i)*t*t*t+a},easeOutQuart:function(e,t,a,n,i){return-n*((t=t/i-1)*t*t*t-1)+a},easeInOutQuart:function(e,t,a,n,i){return(t/=i/2)<1?n/2*t*t*t*t+a:-n/2*((t-=2)*t*t*t-2)+a},easeInQuint:function(e,t,a,n,i){return n*(t/=i)*t*t*t*t+a},easeOutQuint:function(e,t,a,n,i){return n*((t=t/i-1)*t*t*t*t+1)+a},easeInOutQuint:function(e,t,a,n,i){return(t/=i/2)<1?n/2*t*t*t*t*t+a:n/2*((t-=2)*t*t*t*t+2)+a},easeInSine:function(e,t,a,n,i){return-n*Math.cos(t/i*(Math.PI/2))+n+a},easeOutSine:function(e,t,a,n,i){return n*Math.sin(t/i*(Math.PI/2))+a},easeInOutSine:function(e,t,a,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+a},easeInExpo:function(e,t,a,n,i){return 0==t?a:n*Math.pow(2,10*(t/i-1))+a},easeOutExpo:function(e,t,a,n,i){return t==i?a+n:n*(1-Math.pow(2,-10*t/i))+a},easeInOutExpo:function(e,t,a,n,i){return 0==t?a:t==i?a+n:(t/=i/2)<1?n/2*Math.pow(2,10*(t-1))+a:n/2*(2-Math.pow(2,-10*--t))+a},easeInCirc:function(e,t,a,n,i){return-n*(Math.sqrt(1-(t/=i)*t)-1)+a},easeOutCirc:function(e,t,a,n,i){return n*Math.sqrt(1-(t=t/i-1)*t)+a},easeInOutCirc:function(e,t,a,n,i){return(t/=i/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+a:n/2*(Math.sqrt(1-(t-=2)*t)+1)+a},easeInElastic:function(e,t,a,n,i){var o=1.70158,s=0,r=n;if(0==t)return a;if(1==(t/=i))return a+n;if(s||(s=.3*i),r<Math.abs(n)){r=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/r);return-r*Math.pow(2,10*(t-=1))*Math.sin((t*i-o)*(2*Math.PI)/s)+a},easeOutElastic:function(e,t,a,n,i){var o=1.70158,s=0,r=n;if(0==t)return a;if(1==(t/=i))return a+n;if(s||(s=.3*i),r<Math.abs(n)){r=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/r);return r*Math.pow(2,-10*t)*Math.sin((t*i-o)*(2*Math.PI)/s)+n+a},easeInOutElastic:function(e,t,a,n,i){var o=1.70158,s=0,r=n;if(0==t)return a;if(2==(t/=i/2))return a+n;if(s||(s=i*(.3*1.5)),r<Math.abs(n)){r=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/r);return t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*i-o)*(2*Math.PI)/s)*-.5+a:r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-o)*(2*Math.PI)/s)*.5+n+a},easeInBack:function(e,t,a,n,i,o){return o==undefined&&(o=1.70158),n*(t/=i)*t*((o+1)*t-o)+a},easeOutBack:function(e,t,a,n,i,o){return o==undefined&&(o=1.70158),n*((t=t/i-1)*t*((o+1)*t+o)+1)+a},easeInOutBack:function(e,t,a,n,i,o){return o==undefined&&(o=1.70158),(t/=i/2)<1?n/2*(t*t*((1+(o*=1.525))*t-o))+a:n/2*((t-=2)*t*((1+(o*=1.525))*t+o)+2)+a},easeInBounce:function(e,t,a,n,i){return n-jQuery.easing.easeOutBounce(e,i-t,0,n,i)+a},easeOutBounce:function(e,t,a,n,i){return(t/=i)<1/2.75?n*(7.5625*t*t)+a:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+a:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+a:n*(7.5625*(t-=2.625/2.75)*t+.984375)+a},easeInOutBounce:function(e,t,a,n,i){return t<i/2?.5*jQuery.easing.easeInBounce(e,2*t,0,n,i)+a:.5*jQuery.easing.easeOutBounce(e,2*t-i,0,n,i)+.5*n+a}}),function(){window.notPreviewing=function(e){var t=document.documentElement.hasAttribute("data-turbolinks-preview");return t||"function"!=typeof e||e(),!t},window._img_f_d=function(e){e.onerror=null,e.removeAttribute("onerror"),e.src="//oh3mb2ots.qnssl.com/assets/default-cover-0c1078ec9635dd3f3e453fe7b1a12cfcde6e611b423db1507e2dea6c3022c3dd.png"},window._img_f_a=function(e){e.onerror=null,e.removeAttribute("onerror"),e.src="//oh3mb2ots.qnssl.com/assets/default-avatar-7ee2d2034315585b3763e48b0257270f80175b9801ed078687114c22f3f6ddb9.png"}}(),function(){jQuery.rails&&function(){var e=jQuery.fn.submit,t=jQuery.rails.handleMethod;jQuery.rails.handleMethod=function(a){jQuery.fn.submit=function(){var t=a.data("params");for(var n in t)this.append('<input name="'+n+'" value="'+t[n]+'" type="hidden" />');return e.apply(this,arguments)},t.apply(this,arguments),jQuery.fn.submit=e};var a=jQuery.rails.isCrossDomain;jQuery.rails.isCrossDomain=function(e){try{var t=document.createElement("a");return t.href=e,t.href=t.href,!/banjiajia\.com$/.test(t.hostname)&&a(e)}catch(t){return a(e)}}}()}(),function(){function e(){var e=$(document).scrollTop()>200;$(".side-top")[e?"addClass":"removeClass"]("active")}function t(){var e=$(".main-home-section").removeClass("afloat");if(e.length)for(var t,a=!1,n=$("#header").outerHeight(),i=$(document).scrollTop(),o=e.length-1;o>-1;o--){var s=$(e[o]),r=s.position().top;if(a){var c=1;s.addClass("afloat").css("top",t-s.height()-c);break}i+n+(0===o?0:s.height())-r>0&&(t=r-i,t<n&&(t=n),s.addClass("afloat").css("top",t),a=!0)}}function a(){var e=$("#main-post-filter").removeClass("afloat");if(e.length){var t=e.position().top,a=$("#header").outerHeight(),n=(e.outerHeight(),$(document).scrollTop());if(n+a>t){var i=t-n;i<a&&(i=a),e.addClass("afloat").css("top",i)}}}function n(){if(!$(document.body).hasClass("always-shrink")){var e=$("#header-middle"),t=e.length&&e.is(":visible")?e.outerHeight():0;$(document).scrollTop()>t?$(document.body).addClass(e.length&&e.is(":visible")?"shrink-lg":"shrink"):$(document.body).removeClass("shrink shrink-lg")}}function i(){var e=$("#left-fixed");if(e.length){var t=e.parent();e.removeClass("overflow");e.outerHeight()+e.offset().top>t.outerHeight()+t.offset().top&&e.addClass("overflow")}}function o(){var e=$("#right-fixed");if(e.length){var t=e.parent();e.removeClass("overflow");e.outerHeight()+e.offset().top>t.outerHeight()+t.offset().top&&e.addClass("overflow"),$(document).scrollTop()>$("#likes").position().top?e.addClass("reached-likes"):e.removeClass("reached-likes")}}function s(){var e=$("#image-matcher").data("matcher");if(e){var t=e.getBoundingClientRect(),a=t.top,n=t.bottom;a<window.innerHeight&&n>=0?$("#image-matcher").addClass("active"):$("#image-matcher").removeClass("active")}}function r(e,t){var a=$('<div class="blocker"><div class="modal-spinner" style="display: block"></div></div>'),n=setTimeout(function(){a.appendTo("body")},100);$.get(e).then(function(e){$(e).appendTo("body"),t&&t()},function(e){var t=e.responseJSON;try{t||(t=JSON.parse(e.responseText))}catch(e){}if(t&&"needs_sign_in"===t.errcode)return void window.showSignIn();t&&t["continue"]&&(window.location.href=t["continue"])}).always(function(){clearTimeout(n),a.remove()})}function c(e){if($("#main-search").hasClass("search-expanded")){var t=$(".main-search-form")[0];t&&!$.contains(t,e.target)&&($("#main-search").removeClass("search-expanded"),$("#search-active").prop("checked",!1))}}window.clearAlertMsg=function(){},window.showAlertMsg=function(){},window.loadMarzipano=function(){return"function"!=typeof window.requestAnimationFrame?$.Deferred().reject():window.Marzipano?$.when():jQuery.ajax({url:"http://assets.banjiajia.com/marzipano-0.7.2/marzipano.js",dataType:"script",cache:!0})},window.initPano=function(e,t,a,n){var i=new Marzipano.Viewer(e,{swfPath:"http://assets.banjiajia.com/marzipano-0.7.2/marzipano.swf"}),t=Marzipano.ImageUrlSource.fromString(t),o=new Marzipano.EquirectGeometry([{width:0}]),s=a*Math.PI/180,r=Marzipano.RectilinearView.limit.traditional(window.screen.width,s),c=new Marzipano.RectilinearView({yaw:Math.PI,fov:Math.PI/2},r);i.createScene({source:t,geometry:o,view:c,pinFirstLevel:!0}).switchTo(),i.setIdleMovement(n,Marzipano.autorotate({yawSpeed:.1,targetPitch:0,targetFov:Math.PI/2}))},window.showCoverPano=function(e){window.loadMarzipano().then(function(){$(e).each(function(){var e=$(this);if(!e.find(".main-post-cover-pano-viewer").length){var t=e.data("pano"),a=(e.width(),e.height()),n=$('<div class="main-post-cover-pano-viewer" />').height(a);e.empty().append(n),window.initPano(n[0],t,100,1e3)}}).off("mousedown").on("mousedown",function(){$(this).data("drag",!1)}).off("click").on("click",function(){var e=$(this).data("drag");return!(e&&new Date-e>200)}).off("mousemove").on("mousemove",function(){$(this).data("drag",new Date)})})},window.showCoverPanoOfPage=function(e,t){window.showCoverPano($(e).siblings(".main-home-section-pages").find(".main-home-section-page-"+t+" .main-post-cover-image[data-pano]"))};var l="banjiajia.com";$.ajaxPrefilter(function(e,t,a){var n=document.createElement("a");n.href=e.url,-1!==n.hostname.indexOf(l,n.hostname.length-l.length)&&window.location.host!==n.host&&(a.setRequestHeader("X-CSRF-Token",document.querySelector("meta[name=csrf-token]").getAttribute("content")),e.crossDomain=!0,e.xhrFields={withCredentials:!0})}),$(function(){$("#header > .alert-container.active").length&&window.showAlertMsg()}),$(document).on("scroll",function(){e(),n(),t(),a(),i(),o(),s()});var d={services_url:"https://staging.banjiajia.com/__services",attendances_url:"https://staging.banjiajia.com/__attendances",search_suggestions_url:"https://staging.banjiajia.com/search/suggestions"};window.makeSearchSuggestion=function(e){function t(){var t=$(e.el).val().replace(/^\s+|\s+$/g,"");a[t]||(a[t]=$.getJSON(e.path||d.search_suggestions_url,{query:t})),a[t].then(function(t){$(e.list).empty();for(var a=$('<div class="search-suggestions-list-items"></div>'),n=e.tpl,i=!1,o=0;o<t.length;o++){var s=n(t[o].word||"",t[o].occurrence||"",t[o].html||"",t[o].link||"");a.append(s),i=!0}i?($(e.list).prepend('<div class="search-suggestions-list-header search-recent">\u641c\u7d22\u5efa\u8bae</div>'),$(e.list).append(a),$("#main-suggestions").addClass("hidden")):$("#main-suggestions").removeClass("hidden")})}var a={};$(document).off("click",e.el).on("click",e.el,function(){t()}).off("keyup",e.el).on("keyup",e.el,function(a){if(93!==a.which){var n=e.items();if(38===a.which||40===a.which){for(var i=$(this),o=-1,s=0;s<n.length;s++)$(n[s]).hasClass("active")&&(o=s);o+=38===a.which?-1:1,-1===o&&(o=n.length),-2===o&&(o=-1),(38===a.which&&-1===o||40===a.which&&0===o)&&i.data("user",i.val());var r=n.removeClass("active").eq(o);r.length?(i.val(r.data("search")),r.addClass("active")):i.val(i.data("user"))}else{var c=n.filter(".active");n.removeClass("active"),27===a.which||13===a.which?($(this).val()||13===a.which&&c&&c[0]&&(window.location.href=c[0].href),$(this).blur()):t()}return!1}})},window.makeSearchSuggestion({el:"#main-search",list:"#search-suggestions",items:function(){var e=$("#search-suggestions .search-suggestions-list-item");return e.length||(e=$("#main-suggestions .search-suggestions-list-item")),e},tpl:function(e,t,a,n){return'<a href="'+n+'" class="search-suggestions-list-item" data-count="'+t+'" data-search="'+e+'">'+a+"</a>"}});var u;window.showSignIn=function(){u=$('<div class="blocker"><div class="bjj-signin-modal"><a class="modal-close" href><b></b><b></b><b></b><b></b></a><iframe src="https://staging.banjiajia.com/sign-in?variant=slim" width="400" height="538" class="bjj-sigin-iframe"></iframe></div></div>'),u.appendTo("body")};var f=function(e){"BJJ_USER_SIGNED_IN"===e.data?(u&&u.click(),u=null,window.location.reload()):"TP_SIGNED_IN"===e.data&&parent.postMessage("BJJ_USER_SIGNED_IN","*")};window.removeEventListener("message",f,!1),window.addEventListener("message",f,!1),$(document).off("click",".bjj-signin").on("click",".bjj-signin",function(){return window.showSignIn(),!1}).off("click",".bjj-signin-tp").on("click",".bjj-signin-tp",function(){var e="toolbar=0,status=0,resizable=1,width=700,height=550,left="+(window.screen.width-700)/2+",top="+(window.screen.height-550)/2;return window.open($(this).attr("href"),"tp",e),!1}).off("click",".float-header-close").on("click",".float-header-close",function(){var e=new Date;return e.setFullYear(e.getFullYear()+1),document.cookie="ignorefh=1; path=/; expires="+e.toGMTString()+";",$("body").addClass("ignorefh"),$(".float-header").remove(),!1}).off("click",".player-vcoll").on("click",".player-vcoll",function(){return $(".page-player").toggleClass("vcollapsed"),!1}).off("click",".player-hcoll").on("click",".player-hcoll",function(){var e=$(".page-player");return e.hasClass("vcollapsed")&&e.hasClass("hcollapsed")?e.removeClass("vcollapsed").removeClass("hcollapsed"):e.hasClass("vcollapsed")||e.hasClass("hcollapsed")?e.toggleClass("hcollapsed"):e.addClass("vcollapsed").addClass("hcollapsed"),!1}).off("click",".page-left-side-close").on("click",".page-left-side-close",function(){return window.localStorage&&window.localStorage.setItem("pageLeftSideIgnore",$(this).data("url")),$(".page-left-side-float").remove(),!1}).off("click",".side-top").on("click",".side-top",function(){return $(document).scrollTop(0),!1}).off("click",".side-services").on("click",".side-services",function(){return r(d.services_url,function(){$(".services-tabs a").eq(0).click()}),!1}).off("click",".side-attendances").on("click",".side-attendances",function(){return r(d.attendances_url),!1}).off("click",".main-home-section-item").on("click",".main-home-section-item",function(){var e=$(this).parents(".main-home-section");e.hasClass("afloat")&&($(".main-home-section").removeClass("afloat"),$(document).scrollTop(e.position().top-$("#header").height()),e.addClass("afloat"))}).off("click",".main-user-attend").on("click",".main-user-attend",function(){var e=$(this),t=e.text();return e.addClass("disabled").text(e.data("disable")),$.post(d.attendances_url).then(function(e){e.attended_today&&($("#attendances-today").text(e.attendances_today),$("#consecutive-attendances").text(e.consecutive_attendances),$("#user-balance").text(e.user_balance),$("#main-attendances").addClass("main-attendances-attended"))}).always(function(){e.removeClass("disabled").text(t)}),!1}).off("click",".modal-close, .close-modal").on("click",".modal-close, .close-modal",function(){return $(this).parents(".blocker").click(),"_blank"===$(this).attr("target")}).off("click",".services-tabs a").on("click",".services-tabs a",function(){var e=$(this).parents("li");e.siblings("li").removeClass("active"),e.addClass("active");var t=$($(this).data("target"));return t.siblings(".services-section").removeClass("active"),t.addClass("active"),!1}).off("mouseenter click",".services-selectable").on("mouseenter click",".services-selectable",function(){this.select()}).off("click",".blocker").on("click",".blocker",function(e){e.target===e.currentTarget&&($(this).hasClass("blocker-reusable")?$(this).addClass("hidden"):$(this).remove())}).off("click",".search-toggle").on("click",".search-toggle",function(){var e=616,t=($("body").width()-e)/2,a=$(this).offset().left-e-t+$(this).outerWidth(),n=".user .search .search-checkbox:checked ~ .query { margin-right: "+a+"px; }",i=document.getElementById("search-toggle-css");if(i)i.innerHTML=n;else{var o=document.createElement("style");o.id="search-toggle-css",o.type="text/css",o.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(o)}$("#search-active").prop("checked")?$("#main-search").blur().removeClass("search-expanded"):setTimeout(function(){$("#main-search").focus().addClass("search-expanded")},200)}).off("click",c).on("click",c).off("focus","#main-search").on("focus","#main-search",function(){if(window.localStorage&&!$("#main-suggestions .search-recent").length)try{for(var e=JSON.parse(window.localStorage.getItem("bjj.recent.search")),t=$('<div class="search-suggestions-list-items search-recent"></div>'),a=$("#main-suggestions").data("tpl"),n=!1,i=0;i<e.length;i++){var o=e[i];o=o.replace(/^\s+|\s+$/g,""),o&&(t.append(a.split("\u5bb6").join(o).split(encodeURIComponent("\u5bb6")).join(encodeURIComponent(o))),n=!0)}n&&($("#main-suggestions").prepend(t),$("#main-suggestions").prepend('<div class="search-suggestions-list-header search-recent">\u6700\u8fd1\u641c\u7d22</div>'))}catch(e){}}).off("click","[data-dropdown]").on("click","[data-dropdown]",function(){return!0===$(this).data("clickable")}).off("mouseenter","[data-dropdown]").on("mouseenter","[data-dropdown]",function(){var e=$(this),t=e.parent(),a=e.data("dropdown"),n="#"===a[0]?$(a):t.find(a),i=e.data("delay"),o=function(){clearTimeout(e.data("timeout")),t.addClass("dropdown-menu-active")},s=function(){clearTimeout(e.data("timeout")),i>0?e.data("timeout",setTimeout(function(){t.removeClass("dropdown-menu-active")},i)):t.removeClass("dropdown-menu-active")};o(),e.off("mouseleave").on("mouseleave",s),n.off("mouseenter").on("mouseenter",o),n.off("mouseleave").on("mouseleave",s)}).off("turbolinks:before-visit").on("turbolinks:before-visit",function(){$(".dropdown-menu-active").removeClass("dropdown-menu-active"),window.clearAlertMsg()}),window.playerLoaded=function(){$(".page-player").addClass("loaded")},window.initPageLeftSide=function(e,t){window.localStorage&&window.localStorage.getItem("pageLeftSideIgnore")===t?$("#page-left-side-float").remove():$("#page-left-side-float").replaceWith('<div class="page-left-side-float">'+(e&&t?'<a rel="nofollow" class="page-left-side-close" title="\u4ee5\u540e\u4e0d\u663e\u793a" data-url="'+t+'" href><b></b><b></b><b></b><b></b></a><a rel="nofollow" target="_blank" href="'+t+'"><img src="'+e+'"></a>':'<div class="page-player hcollapsed vcollapsed"><div class="player-hcoll"></div><div class="player-vcoll"></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="450" onload="window.playerLoaded()" src="//music.163.com/outchain/player?type=4&id=791690382&auto=0&height=430"></iframe></div>')+"</div>")},window.Turbolinks&&(window.Turbolinks.HttpRequest.prototype.requestLoaded=function(){return this.endRequest(function(e){return function(){var t=e.xhr.status;return 200<=t&&t<300||404===t||500===t?e.delegate.requestCompletedWithResponse(e.xhr.responseText,e.xhr.getResponseHeader("Turbolinks-Location")):(e.failed=!0,e.delegate.requestFailedWithStatusCode(t,e.xhr.responseText))}}(this))})}();