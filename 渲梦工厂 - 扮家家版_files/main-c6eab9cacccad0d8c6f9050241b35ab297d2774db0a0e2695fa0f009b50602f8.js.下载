(function(){(function(){(function(){var t=[].slice;this.ActionCable={INTERNAL:{message_types:{welcome:"welcome",ping:"ping",confirmation:"confirm_subscription",rejection:"reject_subscription"},default_mount_path:"/cable",protocols:["actioncable-v1-json","actioncable-unsupported"]},WebSocket:window.WebSocket,logger:window.console,createConsumer:function(t){var n;return null==t&&(t=null!=(n=this.getConfig("url"))?n:this.INTERNAL.default_mount_path),new e.Consumer(this.createWebSocketURL(t))},getConfig:function(e){var t;return t=document.head.querySelector("meta[name='action-cable-"+e+"']"),null!=t?t.getAttribute("content"):void 0},createWebSocketURL:function(e){var t;return e&&!/^wss?:/i.test(e)?(t=document.createElement("a"),t.href=e,t.href=t.href,t.protocol=t.protocol.replace("http","ws"),t.href):e},startDebugging:function(){return this.debugging=!0},stopDebugging:function(){return this.debugging=null},log:function(){var e,n;if(e=1<=arguments.length?t.call(arguments,0):[],this.debugging)return e.push(Date.now()),(n=this.logger).log.apply(n,["[ActionCable]"].concat(t.call(e)))}}}).call(this)}).call(this);var e=this.ActionCable;(function(){(function(){var t=function(e,t){return function(){return e.apply(t,arguments)}};e.ConnectionMonitor=function(){function n(e){this.connection=e,this.visibilityDidChange=t(this.visibilityDidChange,this),this.reconnectAttempts=0}var i,o,a;return n.pollInterval={min:3,max:30},n.staleThreshold=6,n.prototype.start=function(){if(!this.isRunning())return this.startedAt=o(),delete this.stoppedAt,this.startPolling(),document.addEventListener("visibilitychange",this.visibilityDidChange),e.log("ConnectionMonitor started. pollInterval = "+this.getPollInterval()+" ms")},n.prototype.stop=function(){if(this.isRunning())return this.stoppedAt=o(),this.stopPolling(),document.removeEventListener("visibilitychange",this.visibilityDidChange),e.log("ConnectionMonitor stopped")},n.prototype.isRunning=function(){return null!=this.startedAt&&null==this.stoppedAt},n.prototype.recordPing=function(){return this.pingedAt=o()},n.prototype.recordConnect=function(){return this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,e.log("ConnectionMonitor recorded connect")},n.prototype.recordDisconnect=function(){return this.disconnectedAt=o(),e.log("ConnectionMonitor recorded disconnect")},n.prototype.startPolling=function(){return this.stopPolling(),this.poll()},n.prototype.stopPolling=function(){return clearTimeout(this.pollTimeout)},n.prototype.poll=function(){return this.pollTimeout=setTimeout(function(e){return function(){return e.reconnectIfStale(),e.poll()}}(this),this.getPollInterval())},n.prototype.getPollInterval=function(){var e,t,n,o;return o=this.constructor.pollInterval,n=o.min,t=o.max,e=5*Math.log(this.reconnectAttempts+1),Math.round(1e3*i(e,n,t))},n.prototype.reconnectIfStale=function(){if(this.connectionIsStale())return e.log("ConnectionMonitor detected stale connection. reconnectAttempts = "+this.reconnectAttempts+", pollInterval = "+this.getPollInterval()+" ms, time disconnected = "+a(this.disconnectedAt)+" s, stale threshold = "+this.constructor.staleThreshold+" s"),this.reconnectAttempts++,this.disconnectedRecently()?e.log("ConnectionMonitor skipping reopening recent disconnect"):(e.log("ConnectionMonitor reopening"),this.connection.reopen())},n.prototype.connectionIsStale=function(){var e;return a(null!=(e=this.pingedAt)?e:this.startedAt)>this.constructor.staleThreshold},n.prototype.disconnectedRecently=function(){return this.disconnectedAt&&a(this.disconnectedAt)<this.constructor.staleThreshold},n.prototype.visibilityDidChange=function(){if("visible"===document.visibilityState)return setTimeout(function(t){return function(){if(t.connectionIsStale()||!t.connection.isOpen())return e.log("ConnectionMonitor reopening stale connection on visibilitychange. visbilityState = "+document.visibilityState),t.connection.reopen()}}(this),200)},o=function(){return(new Date).getTime()},a=function(e){return(o()-e)/1e3},i=function(e,t,n){return Math.max(t,Math.min(n,e))},n}()}).call(this),function(){var t,n,i,o,a,r=[].slice,s=function(e,t){return function(){return e.apply(t,arguments)}},c=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};o=e.INTERNAL,n=o.message_types,i=o.protocols,a=2<=i.length?r.call(i,0,t=i.length-1):(t=0,[]),i[t++],e.Connection=function(){function t(t){this.consumer=t,this.open=s(this.open,this),this.subscriptions=this.consumer.subscriptions,this.monitor=new e.ConnectionMonitor(this),this.disconnected=!0}return t.reopenDelay=500,t.prototype.send=function(e){return!!this.isOpen()&&(this.webSocket.send(JSON.stringify(e)),!0)},t.prototype.open=function(){return this.isActive()?(e.log("Attempted to open WebSocket, but existing socket is "+this.getState()),!1):(e.log("Opening WebSocket, current state is "+this.getState()+", subprotocols: "+i),null!=this.webSocket&&this.uninstallEventHandlers(),this.webSocket=new e.WebSocket(this.consumer.url,i),this.installEventHandlers(),this.monitor.start(),!0)},t.prototype.close=function(e){var t,n;if(t=(null!=e?e:{allowReconnect:!0}).allowReconnect,t||this.monitor.stop(),this.isActive())return null!=(n=this.webSocket)?n.close():void 0},t.prototype.reopen=function(){var t;if(e.log("Reopening WebSocket, current state is "+this.getState()),!this.isActive())return this.open();try{return this.close()}catch(n){return t=n,e.log("Failed to reopen WebSocket",t)}finally{e.log("Reopening WebSocket in "+this.constructor.reopenDelay+"ms"),setTimeout(this.open,this.constructor.reopenDelay)}},t.prototype.getProtocol=function(){var e;return null!=(e=this.webSocket)?e.protocol:void 0},t.prototype.isOpen=function(){return this.isState("open")},t.prototype.isActive=function(){return this.isState("open","connecting")},t.prototype.isProtocolSupported=function(){var e;return e=this.getProtocol(),c.call(a,e)>=0},t.prototype.isState=function(){var e,t;return t=1<=arguments.length?r.call(arguments,0):[],e=this.getState(),c.call(t,e)>=0},t.prototype.getState=function(){var e,t;for(t in WebSocket)if(WebSocket[t]===(null!=(e=this.webSocket)?e.readyState:void 0))return t.toLowerCase();return null},t.prototype.installEventHandlers=function(){var e,t;for(e in this.events)t=this.events[e].bind(this),this.webSocket["on"+e]=t},t.prototype.uninstallEventHandlers=function(){var e;for(e in this.events)this.webSocket["on"+e]=function(){}},t.prototype.events={message:function(e){var t,i,o,a;if(this.isProtocolSupported())switch(o=JSON.parse(e.data),t=o.identifier,i=o.message,a=o.type,a){case n.welcome:return this.monitor.recordConnect(),this.subscriptions.reload();case n.ping:return this.monitor.recordPing();case n.confirmation:return this.subscriptions.notify(t,"connected");case n.rejection:return this.subscriptions.reject(t);default:return this.subscriptions.notify(t,"received",i)}},open:function(){if(e.log("WebSocket onopen event, using '"+this.getProtocol()+"' subprotocol"),this.disconnected=!1,!this.isProtocolSupported())return e.log("Protocol is unsupported. Stopping monitor and disconnecting."),this.close({allowReconnect:!1})},close:function(){if(e.log("WebSocket onclose event"),!this.disconnected)return this.disconnected=!0,this.monitor.recordDisconnect(),this.subscriptions.notifyAll("disconnected",{willAttemptReconnect:this.monitor.isRunning()})},error:function(){return e.log("WebSocket onerror event")}},t}()}.call(this),function(){var t=[].slice;e.Subscriptions=function(){function n(e){this.consumer=e,this.subscriptions=[]}return n.prototype.create=function(t,n){var i,o,a;return i=t,o="object"==typeof i?i:{channel:i},a=new e.Subscription(this.consumer,o,n),this.add(a)},n.prototype.add=function(e){return this.subscriptions.push(e),this.consumer.ensureActiveConnection(),this.notify(e,"initialized"),this.sendCommand(e,"subscribe"),e},n.prototype.remove=function(e){return this.forget(e),this.findAll(e.identifier).length||this.sendCommand(e,"unsubscribe"),e},n.prototype.reject=function(e){var t,n,i,o,a;for(i=this.findAll(e),o=[],t=0,n=i.length;t<n;t++)a=i[t],this.forget(a),this.notify(a,"rejected"),o.push(a);return o},n.prototype.forget=function(e){var t;return this.subscriptions=function(){var n,i,o,a;for(o=this.subscriptions,a=[],n=0,i=o.length;n<i;n++)(t=o[n])!==e&&a.push(t);return a}.call(this),e},n.prototype.findAll=function(e){var t,n,i,o,a;for(i=this.subscriptions,o=[],t=0,n=i.length;t<n;t++)a=i[t],a.identifier===e&&o.push(a);return o},n.prototype.reload=function(){var e,t,n,i,o;for(n=this.subscriptions,i=[],e=0,t=n.length;e<t;e++)o=n[e],i.push(this.sendCommand(o,"subscribe"));return i},n.prototype.notifyAll=function(){var e,n,i,o,a,r,s;for(n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],a=this.subscriptions,r=[],i=0,o=a.length;i<o;i++)s=a[i],r.push(this.notify.apply(this,[s,n].concat(t.call(e))));return r},n.prototype.notify=function(){var e,n,i,o,a,r,s;for(r=arguments[0],n=arguments[1],e=3<=arguments.length?t.call(arguments,2):[],s="string"==typeof r?this.findAll(r):[r],a=[],i=0,o=s.length;i<o;i++)r=s[i],a.push("function"==typeof r[n]?r[n].apply(r,e):void 0);return a},n.prototype.sendCommand=function(e,t){var n;return n=e.identifier,this.consumer.send({command:t,identifier:n})},n}()}.call(this),function(){e.Subscription=function(){function e(e,n,i){this.consumer=e,null==n&&(n={}),this.identifier=JSON.stringify(n),t(this,i)}var t;return e.prototype.perform=function(e,t){return null==t&&(t={}),t.action=e,this.send(t)},e.prototype.send=function(e){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(e)})},e.prototype.unsubscribe=function(){return this.consumer.subscriptions.remove(this)},t=function(e,t){var n,i;if(null!=t)for(n in t)i=t[n],e[n]=i;return e},e}()}.call(this),function(){e.Consumer=function(){function t(t){this.url=t,this.subscriptions=new e.Subscriptions(this),this.connection=new e.Connection(this)}return t.prototype.send=function(e){return this.connection.send(e)},t.prototype.connect=function(){return this.connection.open()},t.prototype.disconnect=function(){return this.connection.close({allowReconnect:!1})},t.prototype.ensureActiveConnection=function(){if(!this.connection.isActive())return this.connection.open()},t}()}.call(this)}).call(this),"object"==typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd&&define(e)}).call(this),function(e,t){e.fn.insertAtCaret=function(e){return this.each(function(){var n,i,o,a,r=this,s=0,c="selectionStart"in r&&"selectionEnd"in r;(r.tagName&&"textarea"===r.tagName.toLowerCase()||r.tagName&&"input"===r.tagName.toLowerCase()&&"text"===r.type.toLowerCase())&&(n=r.scrollTop,c?s=r.selectionStart:(r.focus(),a=t.selection.createRange(),a.moveStart("character",-r.value.length),s=a.text.length),i=r.value.substring(0,s),o=r.value.substring(s,r.value.length),r.value=i+e+o,s+=e.length,c?(r.selectionStart=s,r.selectionEnd=s):(a=t.selection.createRange(),a.moveStart("character",s),a.moveEnd("character",0),a.select()),r.scrollTop=n)})}}(jQuery,document,window),function(){window.notPreviewing=function(e){var t=document.documentElement.hasAttribute("data-turbolinks-preview");return t||"function"!=typeof e||e(),!t},window._img_f_d=function(e){e.onerror=null,e.removeAttribute("onerror"),e.src="//oh3mb2ots.qnssl.com/assets/default-cover-0c1078ec9635dd3f3e453fe7b1a12cfcde6e611b423db1507e2dea6c3022c3dd.png"},window._img_f_a=function(e){e.onerror=null,e.removeAttribute("onerror"),e.src="//oh3mb2ots.qnssl.com/assets/default-avatar-7ee2d2034315585b3763e48b0257270f80175b9801ed078687114c22f3f6ddb9.png"}}(),function(){window.BJJ={cable:ActionCable.createConsumer("wss://ws.staging.banjiajia.com/live")}}(),function(){jQuery.rails&&function(){var e=jQuery.fn.submit,t=jQuery.rails.handleMethod;jQuery.rails.handleMethod=function(n){jQuery.fn.submit=function(){var t=n.data("params");for(var i in t)this.append('<input name="'+i+'" value="'+t[i]+'" type="hidden" />');return e.apply(this,arguments)},t.apply(this,arguments),jQuery.fn.submit=e};var n=jQuery.rails.isCrossDomain;jQuery.rails.isCrossDomain=function(e){try{var t=document.createElement("a");return t.href=e,t.href=t.href,!/banjiajia\.com$/.test(t.hostname)&&n(e)}catch(t){return n(e)}}}()}(),function(){function e(e){return $.ajax({url:e,dataType:"script",cache:!0})}function t(e){$.get(o,{year:e}).then(function(t){a[e]=t.attendances,r.addEvents(a[e].map(function(e){return{date:e}}))})}function n(t,n){var o=null;o=window.moment?$.when():e("//cdn.bootcss.com/moment.js/2.17.0/moment.min.js"),o.then(function(){var o=null;o=$.fn.clndr?$.when():e("//cdn.bootcss.com/clndr/1.4.7/clndr.min.js"),o.then(function(){i(t,n)})})}function i(e,n){r=e.clndr({daysOfTheWeek:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],ready:function(){n&&n()},targets:{day:"main-calendar-day",empty:"main-calendar-empty",nextButton:"main-calendar-next",previousButton:"main-calendar-prev"},classes:{event:"main-calendar-event"},clickEvents:{onYearChange:function(e){var n=e.year();a[n]||t(n)}},render:function(e){var t='<div class="main-calendar-header"><div>\u7b7e\u5230\u8bb0\u5f55</div><div><a class="main-calendar-prev" href="javascript:;"></a></div><div>'+this.month.format("YYYY\u5e74MM\u6708")+'</div><div><a class="main-calendar-next" href="javascript:;"></a></div></div>';return t+='<div class="main-calendar-dow clearfix">',$.each(e.daysOfTheWeek,function(e,n){t+='<div class="main-calendar-dow-day">'+n+"</div>"}),t+="</div>",t+='<div class="main-calendar-days clearfix">',$.each(e.days,function(e,n){t+='<div class="'+n.classes+'">'+n.day+"</div>"}),t+="</div>"},showAdjacentMonths:!1})}var o="https://staging.banjiajia.com/__attendances",a={},r=null;$(document).off("mouseenter",".main-forum-attend-button").on("mouseenter",".main-forum-attend-button",function(){r||n($("#attendances-calendar"),function(){t((new Date).getFullYear())})}).off("click",".main-forum-attend-button").on("click",".main-forum-attend-button",function(){var e=$("#main-forum-attend");e.hasClass("active")||e.hasClass("loading")||(e.addClass("loading"),$.post(o).then(function(t){t.attended_today&&(e.addClass("active"),e.find(".today-attendances").text(t.attendances_today)),e.find(".consecutive-attendances").text(t.consecutive_attendances),r&&r.addEvents([{date:t.attended}])},function(e){if("needs_sign_in"===e.responseJSON.errcode)return void window.showSignIn();e.responseJSON&&e.responseJSON["continue"]&&(window.location.href=e.responseJSON["continue"])}).always(function(){e.removeClass("loading")}))})}(),function(){window.registerGT=function(e,t){$.post("/geetest").then(function(t){t.product="bind",window.geetestUseEnglish&&(t.lang="en"),initGeetest(t,e)},t)},window.attachFormGT=function(e){var t=$(e).parents("form"),n=undefined;t.submit(function(){return setTimeout(function(){$.rails.disableFormElements(t)},13),n?(n.verify(),!1):n!==undefined||(window.registerGT(function(e){n=e,n.bindForm(t),n.onClose(function(){$.rails.enableFormElements(t)}),n.onSuccess(function(){n=null,t.submit()}),n.onReady(function(){t.submit()})},function(){$.rails.enableFormElements(t)}),!1)})}}(),function(){function e(e,t){var n=$('<div class="blocker"><div class="modal-spinner" style="display: block"></div></div>'),i=setTimeout(function(){n.appendTo("body")},100);$.get(e).then(function(e){$(e).appendTo("body"),t&&t()},function(e){if("needs_sign_in"===e.responseJSON.errcode)return void window.showSignIn();e.responseJSON&&e.responseJSON["continue"]&&(window.location.href=e.responseJSON["continue"])}).always(function(){clearTimeout(i),n.remove()})}var t={};$(document).off("mouseenter",".main-user-card").on("mouseenter",".main-user-card",function(){var e=$(this),n=e.data("id");n&&($(".main-user-card").each(function(){var e=$(this).data("div");e&&(clearTimeout(e.data("to")),e.data("remove")())}),t[n]=t[n]||$.get("/users/"+n),t[n].then(function(t){var i=$('<div class="main-card-float" />');i.data("id",n),i.html(t),i.insertAfter(e);var o=e.position();i.css({top:o.top-i.outerHeight()-14,left:o.left}),i.data("remove",function(){i.remove(),e.data("div",null)}),e.data("div",i)}))}).off("mouseleave",".main-user-card").on("mouseleave",".main-user-card",function(){var e=$(this).data("div");e&&(clearTimeout(e.data("to")),e.data("to",setTimeout(e.data("remove"),100)))}).off("mouseenter",".main-card-float").on("mouseenter",".main-card-float",function(){clearTimeout($(this).data("to"))}).off("mouseleave",".main-card-float").on("mouseleave",".main-card-float",function(){var e=$(this);clearTimeout(e.data("to")),e.data("remove")()}).off("click",".follow-user").on("click",".follow-user",function(){var e=$(this);return $.post(e.attr("href")).then(function(n){var i=e.parents(".main-card-float");if(i.length){var o=i.data("id");t[o]=$.get("/users/"+o),t[o].then(function(e){i.html(e)})}else n.followed?e.text("\u5df2\u5173\u6ce8").addClass("active"):e.text("\u5173\u6ce8").removeClass("active")},function(e){if("needs_sign_in"===e.responseJSON.errcode)return void window.showSignIn();e.responseJSON&&e.responseJSON["continue"]?window.location.href=e.responseJSON["continue"]:e.responseJSON&&e.responseJSON.message&&window.alert(e.responseJSON.message)}),!1}).off("click",".send-user-pm").on("click",".send-user-pm",function(){return e($(this).attr("href")),!1}).off("submit",".main-pm-form").on("submit",".main-pm-form",function(){var e=$(this),t=e.attr("action"),n=e.serialize();return e.find(".main-activity-input-container").removeClass("field-with-errors").removeAttr("data-error"),$.post(t,n).then(function(t){e.find(".main-activity-form-group, .main-activity-input-container").addClass("hidden"),e.find(".main-card-done").text(t.message).removeClass("hidden");var n=e.parents(".blocker");setTimeout(function(){n.length?n.click():window.location.href=t["continue"]},2e3)},function(t){$.rails.enableFormElements(e);var n=t.responseJSON.errors;for(var i in n){e.find(".main-activity-input-container[data-attr="+i+"]").addClass("field-with-errors").attr("data-error",n[i].join("\u3001"))}}),!1})}(),function(){function e(e){return $.ajax({url:e,dataType:"script",cache:!0})}function t(e,t){$("#"+e).length||$("<link/>",{id:e,rel:"stylesheet",type:"text/css",href:t}).appendTo("head")}function n(e,t,n){var i=new FormData;return i.append("file",e),i.append("key",t),i.append("token",n),$.ajax({url:"https://up.qbox.me",data:i,cache:!1,processData:!1,contentType:!1,type:"POST"})}function i(e){return $.getJSON(r.FILE_UPLOAD).then(function(t){return n(e,t.key,t.token)})}function o(e){return $.getJSON(r.IMAGE_UPLOAD).then(function(t){return n(e,t.key,t.token)})}function a(t,n){function a(e,t,n){var i=h.popups.get(e+".insert");i.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),i.find(".fr-buttons").hide();var o=i.find(".fr-"+e+"-progress-bar-layer");o.addClass("fr-active").removeClass("fr-error");var a="\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7a0d\u5019...";t>=0&&n>=0&&(a+=" ("+t+"/"+n+")"),o.find("h3").text(a),o.find("div").addClass("fr-indeterminate")}function c(e,t,n){var i=$("<img />");i.attr("src",e),i.addClass("fr-dib fr-draggable");var o=!1;if(t&&n){var a=t/n;if(t>p?(t=p,n=Math.round(t/a),o=!0):n>p&&(n=p,t=Math.round(n*a),o=!0),i.css("width",t),i.css("height",n),o&&/assets\.banjiajia\.com|qbox\.me|qnssl\.com/.test(e)){var r=e+(e.indexOf("?")>-1?"&":"?");r+="imageView2/1/w/"+t+"/h/"+n,i.attr("src",r)}}return $("<p />").append($("<a />").attr("href",e).attr("target","_blank").append(i)).prop("outerHTML")}function l(e,t){var n=$("<a />");return n.attr("href",t),n.addClass("fr-file"),n.text("\u4e0b\u8f7d "+e),$("<p />").append(n).prop("outerHTML")}function u(e){var t=[];$.each(e,function(e,n){t.push(n)});var n=0,i=t.length;a("image",n,i),async.mapLimit(t,2,function(e,t){var r=function(){a("image",n++,i),t.apply(null,arguments)};o(e).then(function(e){var t=c(e.url,e.imageInfo.width,e.imageInfo.height);r(undefined,t)},function(e){r(e),window.airbrake&&window.airbrake.notify(JSON.stringify({error:e&&e.responseText?e.responseText:e}))})},function(e,t){a("image",n,i),setTimeout(function(){h.popups.hideAll()},1e3),h.cursor.enter(),h.undo.canDo()||h.undo.saveStep(),h.html.insert(t.join("\n\n"),!0),h.undo.saveStep(),e&&window.alert(s.replace("%{error}","\u81f3\u5c11\u6709\u4e00\u5f20\u56fe\u7247"))})}function d(e){var t=[];$.each(e,function(e,n){t.push(n)});var n=0,o=t.length;a("file",n,o),async.mapLimit(t,2,function(e,t){var r=function(){a("file",n++,o),t.apply(null,arguments)};i(e).then(function(t){var n=l(e.name,t.url);r(undefined,n)},function(e){r(e),window.airbrake&&window.airbrake.notify(JSON.stringify({error:e&&e.responseText?e.responseText:e}))})},function(e,t){a("file",n,o),setTimeout(function(){h.popups.hideAll()},1e3),h.cursor.enter(),h.undo.canDo()||h.undo.saveStep(),h.html.insert(t.join("\n\n"),!0),h.undo.saveStep(),e&&window.alert(s.replace("%{error}","\u81f3\u5c11\u6709\u4e00\u4e2a\u6587\u4ef6"))})}if(1===$(t).length){delete $.FE.PLUGINS.imageManager,delete $.FE.PLUGINS.quickInsert,delete $.FE.PLUGINS.codeView,delete $.FE.PLUGINS.emoticons,$.FE.VIDEO_PROVIDERS.push({test_regex:/^(?:https?:\/\/)?(?:www\.)?(?:bilibili\.com)\/video\/av([0-9]+)(?:.*(?:index_|#page=)([0-9]+).*|.*)$/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:bilibili\.com)\/video\/av([0-9]+)(?:.*(?:index_|#page=)([0-9]+).*|.*)$/g,url_text:"aid=$1&page=$2",html:'<embed width="640" height="360" quality="high" allowfullscreen="true" type="application/x-shockwave-flash" src="https://static-s.bilibili.com/miniloader.swf" flashvars="{url}">'},{test_regex:/^(?:https?:\/\/)?(?:v\.)?(?:youku\.com)\/v_show\/id_(.+?)\.html.*$/,url_regex:/(?:https?:\/\/)?(?:v\.)?(?:youku\.com)\/v_show\/id_(.+?)\.html.*$/g,url_text:"https://players.youku.com/player.php/sid/$1/isAutoPlay/false/newPlayer/true/partnerid/d0044aa962a15bcf/v.swf",html:'<embed width="640" height="360" quality="high" allowfullscreen="true" type="application/x-shockwave-flash" src="{url}" flashvars="imglogo=&paid=0&partnerId=d0044aa962a15bcf&styleid=0">'},{test_regex:/^(https?:\/\/.*\.mp4)$/,url_regex:/^(https?:\/\/.*\.mp4)$/,url_text:"$1",html:'<video width="640" height="360" controls preload="auto"><source src="{url}" type="video/mp4"></video>'}),$.FE.DEFAULTS.imageEditButtons=["imageRemove","imageLink","linkOpen","linkEdit","linkRemove","imageSize"],$.FE.DEFAULTS.linkEditButtons=["linkOpen","linkEdit","linkRemove"],$.FE.DEFAULTS.htmlAllowedAttrs.push("flashvars","quality"),$.FE.DEFAULTS.videoEditButtons=["videoSize","videoRemove"],$.FE.DEFAULTS.videoInsertButtons=["videoBack","|","videoByURL"];var f=$.FE.LANGUAGE.zh_cn.translation;f["Drop image"]="\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u5c0f\u4e8e"+r.MAX_IMAGE_SIZE_MB+"MB\u7684\u56fe\u7247<br>\u53ef\u4e0a\u4f20\u5168\u666f\u56fe\uff0c\u5c3a\u5bf8\u4e0d\u5c0f\u4e8e5000x2500",f["Drop file"]="\u4e0a\u4f20\u5927\u5c0f\u5c0f\u4e8e"+r.MAX_FILE_SIZE_MB+"MB\u7684ZIP\u6216RAR\u538b\u7f29\u5305",f["or click"]="\u70b9\u51fb\u9009\u62e9\u6587\u4ef6\u6216\u628a\u6587\u4ef6\u62d6\u81f3\u6b64\u5904",f["Open in new tab"]="\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00",f["Something went wrong. Please try again."]=s.replace("%{error}",""),e("https://cdn.bootcss.com/airbrake-js/0.9.8/client.min.js").then(function(){window.airbrake=new airbrakeJs.Client({host:"https://airbrake.banjiajia.com",projectId:1,projectKey:"4c3c33af1c35faf2b6ea1a7edf175997"})});var h=$(t).on("froalaEditor.initialized",function(e,t){n(t)}).on("froalaEditor.image.error",function(e,t,n){window.airbrake&&window.airbrake.notify(JSON.stringify({error:n&&n.responseText?n.responseText:n}))}).froalaEditor({language:"zh_cn",toolbarSticky:!0,heightMin:400,charCounterCount:!1,requestWithCORS:!1,imageAllowedTypes:["jpeg","jpg","png","gif"],imageUploadURL:"",fileUploadURL:"",linkList:[{text:"\u626e\u5bb6\u5bb6",href:"//www.banjiajia.com"}],placeholderText:"\u8bf7\u8f93\u5165\u5185\u5bb9",toolbarButtons:["bold","insertLink","insertImage","insertFile","insertVideo","align","fontSize"],toolbarButtonsMD:null,toolbarButtonsSM:null,toolbarButtonsXS:null}).data("froala.editor");$(window).one("popstate",function(){$(t).froalaEditor("destroy")}),$(document).one("turbolinks:before-visit",function(){$(t).froalaEditor("destroy")});var p=900,m=h.popups.create;h.popups.create=function(e,t){return"image.insert"!==e&&"file.insert"!==e||(t.upload_layer=t.upload_layer.replace('type="file"','type="file" multiple')),"file.insert"===e&&(t.upload_layer=t.upload_layer.replace('accept="/*"','accept="application/zip, application/x-rar-compressed, application/x-rar"')),m(e,t)};var v=h.popups.show;h.popups.show=function(e,t,n,i){v(e,t,n,i),"link.insert"===e&&$(".fr-link-insert-layer.fr-active .fr-submit").text()===h.language.translate("Insert")&&$('.fr-link-insert-layer.fr-active [data-checked="_blank"]').prop("checked",!0)},h&&(h.image.upload=u,h.file.upload=d);var g=0,w=window.setInterval(function(){if(g>30)return void window.clearInterval(w);h.image.upload!==u&&(h.image.upload=u),h.file.upload!==d&&(h.file.upload=d),g++},200)}}window.initEditor=function(n,i){t("stylesheet_froala_editor","/assets/external/43981ff7d4f3c9929070800d9331337dafd7eb0e.css");var o=null;$.FE||(o=e("/assets/external/bfab2897a9db1695c1b0ae5d79ad04505f6cadcf.js")),$.when(o).then(function(){a(n,i)})};var r={FILE_UPLOAD:"/drafts/file_upload_token",IMAGE_UPLOAD:"/drafts/image_upload_token",MAX_FILE_SIZE_MB:10,MAX_IMAGE_SIZE_MB:5},s="\u62b1\u6b49\uff0c\u7531\u4e8e\u670d\u52a1\u5668\u95ee\u9898\uff0c%{error}\u4e0a\u4f20\u4e0d\u6210\u529f\u3002\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5\uff0c\u5982\u679c\u95ee\u9898\u6301\u7eed\uff0c\u8bf7\u8054\u7cfb\u5ba2\u670d\u5e76\u63d0\u4f9b\u4f60\u6b63\u5728\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u6d4f\u89c8\u5668\u3002";window.initUploader=function(e){var t=$(e.button),n=t.find(".text"),i=n.text();$(e.chooser).on("change",function(){var a=this.files[0];t.prop("disabled",!0),n.length&&n.text(n.data("disabled")),o(a).then(function(t){var n=$(e.img),i=t.url+"?imageView2/1/w/"+e.width+"/h/"+e.height;n.is("img")?n.attr("src",i):n.addClass("image-set").css("background-image","url("+i+")"),$(e.input).val(t.url)},function(e){var t={413:"\u8bf7\u4e0a\u4f20\u4e0d\u5927\u4e8e"+r.MAX_IMAGE_SIZE_MB+"MB\u7684\u56fe\u7247",403:"\u53ea\u5141\u8bb8JPEG\u3001PNG\u6216GIF\u56fe\u7247"}[e.status]||"\u53d1\u9001\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5";window.alert(t)}).always(function(){t.prop("disabled",!1),n.length&&n.text(i)})})}}(),function(){"use strict";var e="undefined"!=typeof window&&"undefined"!=typeof window.document?window.document:{},t="undefined"!=typeof module&&module.exports,n="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,i=function(){for(var t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],i=0,o=n.length,a={};i<o;i++)if((t=n[i])&&t[1]in e){for(i=0;i<t.length;i++)a[n[0][i]]=t[i];return a}return!1}(),o={change:i.fullscreenchange,error:i.fullscreenerror},a={request:function(t){var o=i.requestFullscreen;t=t||e.documentElement,/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)?t[o]():t[o](n&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){e[i.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(t,n){var i=o[t];i&&e.addEventListener(i,n,!1)},off:function(t,n){var i=o[t];i&&e.removeEventListener(i,n,!1)},raw:i};if(!i)return void(t?module.exports=!1:window.screenfull=!1);Object.defineProperties(a,{isFullscreen:{get:function(){return Boolean(e[i.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[i.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(e[i.fullscreenEnabled])}}}),t?module.exports=a:window.screenfull=a}(),$(function(){function e(e,t,n){var i=new FormData;return i.append("file",e),i.append("key",t),i.append("token",n),$.ajax({url:"https://up.qbox.me",data:i,cache:!1,processData:!1,contentType:!1,type:"POST"})}function t(){var e=$(".posts-comment-image").length;$(".posts-comment-help").text("\u5171"+e+"\u5f20\uff0c\u8fd8\u80fd\u4e0a\u4f20"+(3-e)+"\u5f20"),e>0?$(".posts-comment-ok").removeClass("disabled"):$(".posts-comment-ok").addClass("disabled")}$(document).off("submit",".post-comment-form").on("submit",".post-comment-form",function(){var e=$(this),t=e.attr("action"),n=e.find(".posts-comment-list-image"),i=e.serialize();n.each(function(){var e=$(this).data("url");e&&(i+="&images[]="+encodeURIComponent(e))}),e.find(".main-review-value").each(function(){i+="&"+$(this).data("key")+"="+$(this).text()});var o=$(this).hasClass("no-redirect");return $.post(t,i).then(function(t){if(o){var n=e.parent(".reply-comment"),i=n.prev(".reply").find("[data-toggle]");return n.hasClass("shown")&&(n.removeClass("shown"),i.data("toggle",i.text()),i.text("\u6210\u529f\u56de\u590d")),e[0].reset(),$.rails.enableFormElements(e),void(window.loadComments&&window.loadComments())}"object"==typeof Turbolinks&&"function"==typeof Turbolinks.visit?($.rails.enableFormElements(e),Turbolinks.visit(t["continue"]),$(document).one("turbolinks:load",function(){Turbolinks.visit(t.canonical)})):window.location.href=t["continue"]},function(t){if("needs_sign_in"===t.responseJSON.errcode)return void window.showSignIn();if(t.responseJSON&&t.responseJSON["continue"])return void(window.location.href=t.responseJSON["continue"]);$.rails.enableFormElements(e);var n=e.find(".textarea-container");n.addClass("field-with-errors").attr("data-error",t.responseJSON.message),n.removeClass("review-error"),t.responseJSON.review_error&&n.addClass("review-error")}),!1}).off("click",".upvote, .downvote").on("click",".upvote, .downvote",function(){var e=$(this),t=$("#comments").data(e.hasClass("upvote")?"upvote":"downvote");return $.post(t.replace("ID",$(this).data("id"))).then(function(t){e.parent().find(".active").removeClass("active"),"voted"===t.status&&e.addClass("active");var n=e.parent().find(".votes-total");n.length||(n=e.parent().siblings(".votes-total")),n.text(t.total_votes)},function(e){return"needs_sign_in"===e.responseJSON.errcode?void window.showSignIn():e.responseJSON&&e.responseJSON["continue"]?void(window.location.href=e.responseJSON["continue"]):void(e.responseJSON.fatal&&window.alert(e.responseJSON.message))}),!1}).off("click",".insert-image").on("click",".insert-image",function(){var e=$(this).nextAll(".posts-comment-images-popup");e.toggleClass("active");var n=e.find(".posts-comment-insert");return n.prevAll().remove(),$(".posts-comment-list-image").each(function(){var e=$(this).data("url"),i=$('<div class="posts-comment-image" />');$('<a class="posts-comment-image-remove" href title="\u4e0d\u4e0a\u4f20\u8fd9\u5f20\u56fe\u7247"></a>').appendTo(i).click(function(){return i.remove(),t(),!1}),i.data("url",e),i.css("background-image","url("+e+"?imageView2/1/w/200/h/200)"),i.insertBefore(n)}),t(),!1}).off("change",".comment-image-uploader").on("change",".comment-image-uploader",function(){var n=$(this).parents(".posts-comment-images-popup"),i=n.data("upload");n.find(".posts-comment-ok").off("click").on("click",function(){var e=n.parents(".post-comment-form"),t=e.find(".posts-comment-list").empty();return n.find(".posts-comment-image").each(function(){var e=$('<div class="posts-comment-list-image" />'),n=$(this).data("url");e.data("url",n).css("background-image","url("+n+"?imageView2/1/w/200/h/200)"),$('<a class="posts-comment-list-remove" href title="\u4e0d\u4e0a\u4f20\u8fd9\u5f20\u56fe\u7247"></a>').appendTo(e).click(function(){return e.remove(),!1}),t.append(e)}),n.removeClass("active"),!1});for(var o=n.find(".posts-comment-insert"),a=n.find(".posts-comment-image").length,r=[],s=0;s<this.files.length&&!(a>=3);s++)!function(n){if(-1!==n.type.indexOf("image")){if(n.size>1048576)return void r.push(n.name);var s=$('<div class="posts-comment-image loading" />');$('<a class="posts-comment-image-remove" href title="\u4e0d\u4e0a\u4f20\u8fd9\u5f20\u56fe\u7247"></a>').appendTo(s).click(function(){return s.remove(),t(),!1}),s.insertBefore(o),$.getJSON(i).then(function(i){return e(n,i.key,i.token).then(function(e){
s.data("url",e.url),s.removeClass("loading"),s.css("background-image","url("+e.url+"?imageView2/1/w/200/h/200)"),t()})})["catch"](function(){s.remove()}),a++}}(this.files[s]);r.length&&window.alert("\u4e0b\u5217\u56fe\u7247\u6587\u4ef6\u592a\u5927\uff0c\u4e0d\u5141\u8bb8\u4e0a\u4f20\uff08\u6bcf\u5f20\u56fe\u7247\u4e0d\u80fd\u8d85\u8fc71M\uff09\uff1a\n"+r.join("\n")),this.value=""}).off("click",".reply").on("click",".reply",function(){var e=$(this).find("[data-toggle]"),t=$(this).next(".reply-comment");if(0===t.length){var n=$(this).data("p")||"#post-comment",i=$(this).data("post-id"),o=$(n).find(".post-comment-form").clone();t=$('<div class="reply-comment" />').append(o).insertAfter(this),setTimeout(function(){t.addClass("shown")},50),o.find(".reply-remove").remove();var a=e.data("commenter");a=a?"\u56de\u590d "+a+"\uff1a":"",o.find(".textarea").val("").attr("placeholder",a).trigger("keyup"),o.find(".submit").val("\u56de\u590d"),o.find("input[name=parent_comment_id]").val($(this).data("id")),o.attr("action",o.attr("action").replace("POST_ID",i))}else t.toggleClass("shown");setTimeout(function(){t.hasClass("shown")&&t.find("textarea").focus()},200);var r=e.data("toggle");return e.data("toggle",e.text()),e.text(r),!1}).off("keydown",".main-form textarea").on("keydown",".main-form textarea",function(e){!e.ctrlKey&&!e.metaKey||13!=e.keyCode&&10!=e.keyCode||$(this).parents(".main-form").submit()}).off("keyup",".main-form textarea").on("keyup",".main-form textarea",function(){var e=$(this).val();e.length>500?($(this).val(e.slice(0,500)),$(this).parents(".main-form").find(".count").text(0)):$(this).parents(".main-form").find(".count").text(500-e.length)}).off("click",".smiley-item").on("click",".smiley-item",function(){var e=$(this).parents("form").find("textarea");return e.insertAtCaret($(this).data("smiley")),$(this).parents(".dropdown-menu-active").removeClass("dropdown-menu-active"),e.focus(),!1})}),$(function(){function e(e,t){function n(){e.empty().qrcode({width:128,height:128,text:t})}return e.hasClass("active")?(e.removeClass("active"),!1):(e.addClass("active").empty().append('<div class="loading"></div>'),$.fn.qrcode?n():$.ajax({url:"//cdn.bootcss.com/jquery.qrcode/1.0/jquery.qrcode.min.js",dataType:"script",cache:!0}).then(function(){n()}),!1)}$(document).off("mouseenter",".show-qr-code-hover").on("mouseenter",".show-qr-code-hover",function(){return e($(this.dataset.target),this.getAttribute("href"))}).off("mouseleave",".show-qr-code-hover").on("mouseleave",".show-qr-code-hover",function(){return e($(this.dataset.target),this.getAttribute("href"))}).off("click",".show-qr-code-hover").on("click",".show-qr-code-hover",function(){return!1}).off("click",".show-qr-code").on("click",".show-qr-code",function(){return e($(this.dataset.target),this.getAttribute("href"))}).off("click",".weibo-link").on("click",".weibo-link",function(){function e(){return!window.open(t,"mb","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(window.screen.width-440)/2+",top="+(window.screen.height-430)/2)}var t=this.getAttribute("href");return/Firefox/.test(window.navigator.userAgent)?(setTimeout(e,0),!1):e()})}),function(){function e(e,t){$("#"+e).length||$("<link/>",{id:e,rel:"stylesheet",type:"text/css",href:t}).appendTo("head")}function t(){$(".image-matcher-button.active").removeClass("active"),$("#image-matcher").removeClass("active").removeData("matcher"),$(".image-matcher-results").empty()}function n(e){var t=e.data("index"),n=e.width(),i=e.attr("href")+"?imageView2/2/w/5000",o=$('<div class="main-pano-viewer" />').height(10*n/16);e.replaceWith(o),window.initPano(o[0],i,90,3e3),screenfull.enabled&&o.append('<a href class="main-pano-viewer-fullscreen"></a>');var a=$(".main-post-content").data("id"),r=window.location.protocol+"//"+window.location.host+"/panos/"+a+"/"+t;o.append('<div id="pano-qrcode-'+t+'" class="main-pano-viewer-qrcode"></div>'),o.append('<a href="'+r+'" class="main-pano-viewer-mobile show-qr-code-hover" data-target="#pano-qrcode-'+t+'"></a>')}function i(){var e=window.location.hash;/^#comment-(\d+)$/.test(e)&&$(e).addClass("target"),$(document).trigger("scroll")}window.initPost=function(){e("lightgallery_css","//cdn.bootcss.com/lightgallery/1.6.0/css/lightgallery.min.css");var t=0;$(".main-post-content img").each(function(){var e=$(this).parent();"A"!==this.parentNode.nodeName?($(this).wrap("<a />"),e=$(this).parent(),e.addClass("post-content-image").data("index",t),e.attr("href",this.src).attr("target","_blank")):0===this.src.indexOf(e.attr("href"))&&e.addClass("post-content-image").data("index",t),t++}),$(".main-post-content").imagesLoaded(function(){$(".main-post-content img").each(function(){var e=$(this).parent(".post-content-image"),t="post-content-image-normal";if($(this).hasClass("fr-not-pano"))return void e.addClass(t);if($(this).width()>=600&&$(this).width()===2*$(this).height()){t="post-content-image-pano",e.attr("title","\u70b9\u51fb\u53ef\u67e5\u770b\u5168\u666f\u56fe"),e.append('<div class="post-content-image-pano-button">\u5168\u666f\u56fe</div>');var n=e.data("index"),i=$(".main-post-content").data("id"),o=window.location.protocol+"//"+window.location.host+"/panos/"+i+"/"+n;e.append('<div id="pano-qrcode-'+n+'" class="main-pano-viewer-qrcode"></div>'),e.append('<a href="'+o+'" class="main-pano-viewer-mobile show-qr-code-hover" data-target="#pano-qrcode-'+n+'"></a>')}e.addClass(t)}),$(".main-post-content").lightGallery({thumbnail:!0,mode:"lg-slide",download:!1,selector:".post-content-image.post-content-image-normal"})});$(".main-post-comment-images").lightGallery({width:"800px",height:"600px",addClass:"post-comment-gallery",mode:"lg-slide",download:!1,selector:".main-post-comment-image",speed:500})},$(document).off("click",".post-content-image-pano").on("click",".post-content-image-pano",function(){var e=$(this);return window.loadMarzipano().then(function(){n(e)}),!1}).off("click",".main-pano-viewer-fullscreen").on("click",".main-pano-viewer-fullscreen",function(){var e=$(this).parent(".main-pano-viewer").addClass("none");return setTimeout(function(){screenfull.isFullscreen||e.hasClass("active")&&window.innerHeight!==window.screen.height?(screenfull.exit(),e.next(".main-pano-viewer-placeholder").remove(),e.removeClass("active")):(screenfull.request(),$('<div class="main-pano-viewer-placeholder" />').width(e.width()).height(e.height()).insertAfter(e),e.addClass("active")),setTimeout(function(){e.removeClass("none")},500)},500),!1}).off("mouseover",".main-review-bar").on("mouseover",".main-review-bar",function(e){if(!$(this).hasClass("main-review-set")){var t=$(e.target).prevAll("b").addBack().addClass("active").length;$(e.target).nextAll("b").removeClass("active"),$(this).next(".main-review-value").text(t)}}).off("mouseout",".main-review-bar").on("mouseout",".main-review-bar",function(){$(this).hasClass("main-review-set")||($(this).find("b").removeClass("active"),$(this).next(".main-review-value").text(0))}).off("click",".main-review-bar").on("click",".main-review-bar",function(e){if(0!==$(this).parents(".main-review").find(".main-review-bar").not(".main-review-set").length){$(this).addClass("main-review-set");var t=$(e.target).prevAll("b").addBack().addClass("active").length;$(e.target).nextAll("b").removeClass("active"),$(this).next(".main-review-value").text(t)}}).off("click",".add-bookmark").on("click",".add-bookmark",function(){var e=$(this),t=$("#likes").data("bookmarks");return $.post(t).then(function(t){"bookmarked"===t.status?e.addClass("active"):e.removeClass("active")},function(e){if("needs_sign_in"===e.responseJSON.errcode)return void window.showSignIn();showAlertMsg(e.responseJSON.message)}),!1}).off("click",".add-like").on("click",".add-like",function(){var e=$(this),t=$("#likes").data("likes");return $.post(t).then(function(t){"voted"===t.status?e.addClass("active"):e.removeClass("active"),$(".post-likes-status").each(function(){$(this).text($(this).data("text")["voted"===t.status])}),$(".post-likes-count").text(t.number_with_delimiter.likes_count)},function(e){if("needs_sign_in"===e.responseJSON.errcode)return void window.showSignIn();showAlertMsg(e.responseJSON.message);var t=e.responseJSON["continue"];t&&(window.Turbolinks?window.Turbolinks.visit(t):window.location.href=t)}),!1}).off("click",".side-comment-btn").on("click",".side-comment-btn",function(){$(".side-comment-btn").toggleClass("active"),$(".side-comment").toggleClass("active");var e=$(".side-comment").first();return e.hasClass("active")&&e.find("textarea").focus(),!1}).off("click",".image-matcher-button").on("click",".image-matcher-button",function(){if($(this).hasClass("active"))return t(),!1;$(".image-matcher.with-hints").removeClass("with-hints"),$(".image-matcher-button.active").removeClass("active"),$(this).addClass("active");var e=$(this).parents(".image-matcher");$("#image-matcher").addClass("active").data("matcher",e[0]),$(".image-matcher-results").empty().addClass("loading");var n=e.find("img").attr("src");return n=n.replace(/\?.*$/,""),n=n.replace(/-proper$/,""),n+="?imageView2/2/w/500",$.post("/SearchImageByURL",{url:n}).then(function(e){var t=e.results;if(!t||!t.length)throw"empty";for(var n=[],i=0;i<t.length;i++)if(n.push(/\d+$/.exec(t[i].html_url)[0]),!(i>=12)){var o=$('<a class="image-matcher-result" target="_blank" />').attr("href",t[i].html_url).css("background-image","url("+t[i].image_url+"?imageView2/2/w/220)");$(".image-matcher-results").append(o)}$(".image-matcher-results").append('<a class="image-matcher-more" target="_blank" href="http://search.xiadele.com/plus/search.php?keyword='+n.join("+")+'">\u67e5\u770b\u66f4\u591a\u76f8\u4f3c\u7d20\u6750</a>')}).then(null,function(){$(".image-matcher-results").append('<div class="image-matcher-message">\u6682\u65f6\u65e0\u6cd5\u83b7\u53d6\u76f8\u4f3c\u7d20\u6750</div>')}).always(function(){$(".image-matcher-results").removeClass("loading")}),!1}).off("click",".image-matcher-results-close").on("click",".image-matcher-results-close",function(){return t(),!1}).off("turbolinks:load",i).on("turbolinks:load",i),$(window).on("hashchange",function(){$(".anchor.target").removeClass("target")})}(),function(){function e(){var e=$(document).scrollTop()>200;$(".side-top")[e?"addClass":"removeClass"]("active")}function t(){var e=$(".main-home-section").removeClass("afloat");if(e.length)for(var t,n=!1,i=$("#header").outerHeight(),o=$(document).scrollTop(),a=e.length-1;a>-1;a--){var r=$(e[a]),s=r.position().top;if(n){var c=1;r.addClass("afloat").css("top",t-r.height()-c);break}o+i+(0===a?0:r.height())-s>0&&(t=s-o,t<i&&(t=i),r.addClass("afloat").css("top",t),n=!0)}}function n(){var e=$("#main-post-filter").removeClass("afloat");if(e.length){var t=e.position().top,n=$("#header").outerHeight(),i=(e.outerHeight(),$(document).scrollTop());if(i+n>t){var o=t-i;o<n&&(o=n),e.addClass("afloat").css("top",o)}}}function i(){if(!$(document.body).hasClass("always-shrink")){var e=$("#header-middle"),t=e.length&&e.is(":visible")?e.outerHeight():0;$(document).scrollTop()>t?$(document.body).addClass(e.length&&e.is(":visible")?"shrink-lg":"shrink"):$(document.body).removeClass("shrink shrink-lg")}}function o(){var e=$("#left-fixed");if(e.length){var t=e.parent();e.removeClass("overflow");e.outerHeight()+e.offset().top>t.outerHeight()+t.offset().top&&e.addClass("overflow")}}function a(){var e=$("#right-fixed");if(e.length){var t=e.parent();e.removeClass("overflow");e.outerHeight()+e.offset().top>t.outerHeight()+t.offset().top&&e.addClass("overflow"),$(document).scrollTop()>$("#likes").position().top?e.addClass("reached-likes"):e.removeClass("reached-likes")}}function r(){var e=$("#image-matcher").data("matcher");if(e){var t=e.getBoundingClientRect(),n=t.top,i=t.bottom;n<window.innerHeight&&i>=0?$("#image-matcher").addClass("active"):$("#image-matcher").removeClass("active")}}function s(e,t){var n=$('<div class="blocker"><div class="modal-spinner" style="display: block"></div></div>'),i=setTimeout(function(){n.appendTo("body")},100);$.get(e).then(function(e){$(e).appendTo("body"),t&&t()},function(e){var t=e.responseJSON;try{t||(t=JSON.parse(e.responseText))}catch(e){}if(t&&"needs_sign_in"===t.errcode)return void window.showSignIn();t&&t["continue"]&&(window.location.href=t["continue"])}).always(function(){clearTimeout(i),n.remove()})}function c(e){if($("#main-search").hasClass("search-expanded")){var t=$(".main-search-form")[0];t&&!$.contains(t,e.target)&&($("#main-search").removeClass("search-expanded"),$("#search-active").prop("checked",!1))}}window.clearAlertMsg=function(){},window.showAlertMsg=function(){},window.loadMarzipano=function(){return"function"!=typeof window.requestAnimationFrame?$.Deferred().reject():window.Marzipano?$.when():jQuery.ajax({url:"http://assets.banjiajia.com/marzipano-0.7.2/marzipano.js",dataType:"script",cache:!0})},window.initPano=function(e,t,n,i){var o=new Marzipano.Viewer(e,{swfPath:"http://assets.banjiajia.com/marzipano-0.7.2/marzipano.swf"}),t=Marzipano.ImageUrlSource.fromString(t),a=new Marzipano.EquirectGeometry([{width:0}]),r=n*Math.PI/180,s=Marzipano.RectilinearView.limit.traditional(window.screen.width,r),c=new Marzipano.RectilinearView({yaw:Math.PI,fov:Math.PI/2},s);o.createScene({source:t,geometry:a,view:c,pinFirstLevel:!0}).switchTo(),o.setIdleMovement(i,Marzipano.autorotate({yawSpeed:.1,targetPitch:0,targetFov:Math.PI/2}))},window.showCoverPano=function(e){window.loadMarzipano().then(function(){$(e).each(function(){var e=$(this);if(!e.find(".main-post-cover-pano-viewer").length){var t=e.data("pano"),n=(e.width(),e.height()),i=$('<div class="main-post-cover-pano-viewer" />').height(n);e.empty().append(i),window.initPano(i[0],t,100,1e3)}}).off("mousedown").on("mousedown",function(){$(this).data("drag",!1)}).off("click").on("click",function(){var e=$(this).data("drag");return!(e&&new Date-e>200)}).off("mousemove").on("mousemove",function(){$(this).data("drag",new Date)})})},window.showCoverPanoOfPage=function(e,t){window.showCoverPano($(e).siblings(".main-home-section-pages").find(".main-home-section-page-"+t+" .main-post-cover-image[data-pano]"))};var l="banjiajia.com";$.ajaxPrefilter(function(e,t,n){var i=document.createElement("a");i.href=e.url,-1!==i.hostname.indexOf(l,i.hostname.length-l.length)&&window.location.host!==i.host&&(n.setRequestHeader("X-CSRF-Token",document.querySelector("meta[name=csrf-token]").getAttribute("content")),e.crossDomain=!0,e.xhrFields={withCredentials:!0})}),$(function(){$("#header > .alert-container.active").length&&window.showAlertMsg()}),$(document).on("scroll",function(){e(),i(),t(),n(),o(),a(),r()});var u={services_url:"https://staging.banjiajia.com/__services",attendances_url:"https://staging.banjiajia.com/__attendances",search_suggestions_url:"https://staging.banjiajia.com/search/suggestions"};window.makeSearchSuggestion=function(e){function t(){var t=$(e.el).val().replace(/^\s+|\s+$/g,"");n[t]||(n[t]=$.getJSON(e.path||u.search_suggestions_url,{query:t})),n[t].then(function(t){$(e.list).empty();for(var n=$('<div class="search-suggestions-list-items"></div>'),i=e.tpl,o=!1,a=0;a<t.length;a++){var r=i(t[a].word||"",t[a].occurrence||"",t[a].html||"",t[a].link||"");n.append(r),o=!0}o?($(e.list).prepend('<div class="search-suggestions-list-header search-recent">\u641c\u7d22\u5efa\u8bae</div>'),$(e.list).append(n),$("#main-suggestions").addClass("hidden")):$("#main-suggestions").removeClass("hidden")})}var n={};$(document).off("click",e.el).on("click",e.el,function(){t()}).off("keyup",e.el).on("keyup",e.el,function(n){if(93!==n.which){var i=e.items();if(38===n.which||40===n.which){for(var o=$(this),a=-1,r=0;r<i.length;r++)$(i[r]).hasClass("active")&&(a=r);a+=38===n.which?-1:1,-1===a&&(a=i.length),-2===a&&(a=-1),(38===n.which&&-1===a||40===n.which&&0===a)&&o.data("user",o.val());var s=i.removeClass("active").eq(a);s.length?(o.val(s.data("search")),s.addClass("active")):o.val(o.data("user"))}else{var c=i.filter(".active");i.removeClass("active"),27===n.which||13===n.which?($(this).val()||13===n.which&&c&&c[0]&&(window.location.href=c[0].href),$(this).blur()):t()}return!1}})},window.makeSearchSuggestion({el:"#main-search",list:"#search-suggestions",items:function(){var e=$("#search-suggestions .search-suggestions-list-item");return e.length||(e=$("#main-suggestions .search-suggestions-list-item")),e},tpl:function(e,t,n,i){return'<a href="'+i+'" class="search-suggestions-list-item" data-count="'+t+'" data-search="'+e+'">'+n+"</a>"}});var d;window.showSignIn=function(){d=$('<div class="blocker"><div class="bjj-signin-modal"><a class="modal-close" href><b></b><b></b><b></b><b></b></a><iframe src="https://staging.banjiajia.com/sign-in?variant=slim" width="400" height="538" class="bjj-sigin-iframe"></iframe></div></div>'),d.appendTo("body")};var f=function(e){"BJJ_USER_SIGNED_IN"===e.data?(d&&d.click(),d=null,window.location.reload()):"TP_SIGNED_IN"===e.data&&parent.postMessage("BJJ_USER_SIGNED_IN","*")};window.removeEventListener("message",f,!1),window.addEventListener("message",f,!1),$(document).off("click",".bjj-signin").on("click",".bjj-signin",function(){return window.showSignIn(),!1}).off("click",".bjj-signin-tp").on("click",".bjj-signin-tp",function(){var e="toolbar=0,status=0,resizable=1,width=700,height=550,left="+(window.screen.width-700)/2+",top="+(window.screen.height-550)/2;return window.open($(this).attr("href"),"tp",e),!1}).off("click",".float-header-close").on("click",".float-header-close",function(){var e=new Date;return e.setFullYear(e.getFullYear()+1),document.cookie="ignorefh=1; path=/; expires="+e.toGMTString()+";",$("body").addClass("ignorefh"),$(".float-header").remove(),!1}).off("click",".player-vcoll").on("click",".player-vcoll",function(){return $(".page-player").toggleClass("vcollapsed"),!1}).off("click",".player-hcoll").on("click",".player-hcoll",function(){var e=$(".page-player");return e.hasClass("vcollapsed")&&e.hasClass("hcollapsed")?e.removeClass("vcollapsed").removeClass("hcollapsed"):e.hasClass("vcollapsed")||e.hasClass("hcollapsed")?e.toggleClass("hcollapsed"):e.addClass("vcollapsed").addClass("hcollapsed"),!1}).off("click",".page-left-side-close").on("click",".page-left-side-close",function(){return window.localStorage&&window.localStorage.setItem("pageLeftSideIgnore",$(this).data("url")),$(".page-left-side-float").remove(),!1}).off("click",".side-top").on("click",".side-top",function(){return $(document).scrollTop(0),!1}).off("click",".side-services").on("click",".side-services",function(){return s(u.services_url,function(){$(".services-tabs a").eq(0).click()}),!1}).off("click",".side-attendances").on("click",".side-attendances",function(){return s(u.attendances_url),!1}).off("click",".main-home-section-item").on("click",".main-home-section-item",function(){var e=$(this).parents(".main-home-section");e.hasClass("afloat")&&($(".main-home-section").removeClass("afloat"),$(document).scrollTop(e.position().top-$("#header").height()),e.addClass("afloat"))}).off("click",".main-user-attend").on("click",".main-user-attend",function(){var e=$(this),t=e.text();return e.addClass("disabled").text(e.data("disable")),$.post(u.attendances_url).then(function(e){e.attended_today&&($("#attendances-today").text(e.attendances_today),$("#consecutive-attendances").text(e.consecutive_attendances),$("#user-balance").text(e.user_balance),$("#main-attendances").addClass("main-attendances-attended"))}).always(function(){e.removeClass("disabled").text(t)}),!1}).off("click",".modal-close, .close-modal").on("click",".modal-close, .close-modal",function(){return $(this).parents(".blocker").click(),"_blank"===$(this).attr("target")}).off("click",".services-tabs a").on("click",".services-tabs a",function(){var e=$(this).parents("li");e.siblings("li").removeClass("active"),e.addClass("active");var t=$($(this).data("target"));return t.siblings(".services-section").removeClass("active"),t.addClass("active"),!1}).off("mouseenter click",".services-selectable").on("mouseenter click",".services-selectable",function(){this.select()}).off("click",".blocker").on("click",".blocker",function(e){e.target===e.currentTarget&&($(this).hasClass("blocker-reusable")?$(this).addClass("hidden"):$(this).remove())}).off("click",".search-toggle").on("click",".search-toggle",function(){var e=616,t=($("body").width()-e)/2,n=$(this).offset().left-e-t+$(this).outerWidth(),i=".user .search .search-checkbox:checked ~ .query { margin-right: "+n+"px; }",o=document.getElementById("search-toggle-css");if(o)o.innerHTML=i;else{var a=document.createElement("style");a.id="search-toggle-css",a.type="text/css",a.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(a)}$("#search-active").prop("checked")?$("#main-search").blur().removeClass("search-expanded"):setTimeout(function(){$("#main-search").focus().addClass("search-expanded")},200)}).off("click",c).on("click",c).off("focus","#main-search").on("focus","#main-search",function(){if(window.localStorage&&!$("#main-suggestions .search-recent").length)try{for(var e=JSON.parse(window.localStorage.getItem("bjj.recent.search")),t=$('<div class="search-suggestions-list-items search-recent"></div>'),n=$("#main-suggestions").data("tpl"),i=!1,o=0;o<e.length;o++){var a=e[o];a=a.replace(/^\s+|\s+$/g,""),a&&(t.append(n.split("\u5bb6").join(a).split(encodeURIComponent("\u5bb6")).join(encodeURIComponent(a))),i=!0)}i&&($("#main-suggestions").prepend(t),$("#main-suggestions").prepend('<div class="search-suggestions-list-header search-recent">\u6700\u8fd1\u641c\u7d22</div>'))}catch(e){}}).off("click","[data-dropdown]").on("click","[data-dropdown]",function(){return!0===$(this).data("clickable")}).off("mouseenter","[data-dropdown]").on("mouseenter","[data-dropdown]",function(){var e=$(this),t=e.parent(),n=e.data("dropdown"),i="#"===n[0]?$(n):t.find(n),o=e.data("delay"),a=function(){clearTimeout(e.data("timeout")),t.addClass("dropdown-menu-active")},r=function(){clearTimeout(e.data("timeout")),o>0?e.data("timeout",setTimeout(function(){t.removeClass("dropdown-menu-active")},o)):t.removeClass("dropdown-menu-active")};a(),e.off("mouseleave").on("mouseleave",r),i.off("mouseenter").on("mouseenter",a),i.off("mouseleave").on("mouseleave",r)}).off("turbolinks:before-visit").on("turbolinks:before-visit",function(){$(".dropdown-menu-active").removeClass("dropdown-menu-active"),window.clearAlertMsg()}),window.playerLoaded=function(){$(".page-player").addClass("loaded")},window.initPageLeftSide=function(e,t){window.localStorage&&window.localStorage.getItem("pageLeftSideIgnore")===t?$("#page-left-side-float").remove():$("#page-left-side-float").replaceWith('<div class="page-left-side-float">'+(e&&t?'<a rel="nofollow" class="page-left-side-close" title="\u4ee5\u540e\u4e0d\u663e\u793a" data-url="'+t+'" href><b></b><b></b><b></b><b></b></a><a rel="nofollow" target="_blank" href="'+t+'"><img src="'+e+'"></a>':'<div class="page-player hcollapsed vcollapsed"><div class="player-hcoll"></div><div class="player-vcoll"></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="450" onload="window.playerLoaded()" src="//music.163.com/outchain/player?type=4&id=791690382&auto=0&height=430"></iframe></div>')+"</div>")},window.Turbolinks&&(window.Turbolinks.HttpRequest.prototype.requestLoaded=function(){return this.endRequest(function(e){return function(){var t=e.xhr.status;return 200<=t&&t<300||404===t||500===t?e.delegate.requestCompletedWithResponse(e.xhr.responseText,e.xhr.getResponseHeader("Turbolinks-Location")):(e.failed=!0,e.delegate.requestFailedWithStatusCode(t,e.xhr.responseText))}}(this))})}(),function(e){e.fn.slide=function(t){return e.fn.slide.defaults={type:"slide",effect:"fade",autoPlay:!1,delayTime:500,interTime:2500,triggerTime:150,defaultIndex:0,titCell:".hd li",mainCell:".bd",targetCell:null,trigger:"mouseover",scroll:1,vis:1,titOnClassName:"on",autoPage:!1,prevCell:".prev",nextCell:".next",pageStateCell:".pageState",opp:!1,pnLoop:!0,easing:"swing",startFun:null,endFun:null,switchLoad:null,playStateCell:".playState",mouseOverStop:!0,defaultPlay:!0,returnDefault:!1},this.each(function(){var n,i=e.extend({},e.fn.slide.defaults,t),o=e(this),a=i.effect,r=e(i.prevCell,o),s=e(i.nextCell,o),c=e(i.pageStateCell,o),l=e(i.playStateCell,o),u=e(i.titCell,o),d=u.length,f=e(i.mainCell,o),h=f.children().length,p=i.switchLoad,m=e(i.targetCell,o),v=parseInt(i.defaultIndex),g=parseInt(i.delayTime),w=parseInt(i.interTime),b=(parseInt(i.triggerTime),parseInt(i.scroll)),y=parseInt(i.vis),$="false"!=i.autoPlay&&0!=i.autoPlay,k="false"!=i.opp&&0!=i.opp,C="false"!=i.autoPage&&0!=i.autoPage,S="false"!=i.pnLoop&&0!=i.pnLoop,x="false"!=i.mouseOverStop&&0!=i.mouseOverStop,_="false"!=i.defaultPlay&&0!=i.defaultPlay,I="false"!=i.returnDefault&&0!=i.returnDefault,T=0,E=0,M=0,j=0,A=i.easing,O=null,q=null,P=null,F=i.titOnClassName,N=u.index(o.find("."+F)),L=v=-1==N?v:N,D=v,R=v,J=h>=y?h%b!=0?h%b:b:0,B="leftMarquee"==a||"topMarquee"==a,U=function(){e.isFunction(i.startFun)&&i.startFun(v,d,o,e(i.titCell,o),f,m,r,s)},z=function(){e.isFunction(i.endFun)&&i.endFun(v,d,o,e(i.titCell,o),f,m,r,s)},Q=function(){u.removeClass(F),_&&u.eq(D).addClass(F)};if("menu"==i.type)return _&&u.removeClass(F).eq(v).addClass(F),u.hover(function(){n=e(this).find(i.targetCell);var t=u.index(e(this));q=setTimeout(function(){switch(v=t,u.removeClass(F).eq(v).addClass(F),U(),a){case"fade":n.stop(!0,!0).animate({opacity:"show"},g,A,z);break;case"slideDown":n.stop(!0,!0).animate({height:"show"},g,A,z)}},i.triggerTime)},function(){switch(clearTimeout(q),a){case"fade":n.animate({opacity:"hide"},g,A);break;case"slideDown":n.animate({height:"hide"},g,A)}}),void(I&&o.hover(function(){clearTimeout(P)},function(){P=setTimeout(Q,g)}));if(0==d&&(d=h),B&&(d=2),C){if(h>=y)if("leftLoop"==a||"topLoop"==a)d=h%b!=0?1+(h/b^0):h/b;else{var W=h-y;d=1+parseInt(W%b!=0?W/b+1:W/b),d<=0&&(d=1)}else d=1;u.html("");var G="";if(1==i.autoPage||"true"==i.autoPage)for(var H=0;H<d;H++)G+="<li>"+(H+1)+"</li>";else for(var H=0;H<d;H++)G+=i.autoPage.replace("$",H+1);u.html(G);var u=u.children()}if(h>=y){f.children().each(function(){e(this).width()>M&&(M=e(this).width(),E=e(this).outerWidth(!0)),e(this).height()>j&&(j=e(this).height(),T=e(this).outerHeight(!0))});var V=f.children(),Y=function(){for(var e=0;e<y;e++)V.eq(e).clone().addClass("clone").appendTo(f);for(var e=0;e<J;e++)V.eq(h-e-1).clone().addClass("clone").prependTo(f)};switch(a){case"fold":f.css({position:"relative",width:E,height:T}).children().css({position:"absolute",width:M,left:0,top:0,display:"none"});break;case"top":f.wrap('<div class="tempWrap" style="overflow:hidden; position:relative; height:'+y*T+'px"></div>').css({top:-v*b*T,position:"relative",padding:"0",margin:"0"}).children().css({height:j});break;case"left":f.wrap('<div class="tempWrap" style="overflow:hidden; position:relative; width:'+y*E+'px"></div>').css({width:h*E,left:-v*b*E,position:"relative",overflow:"hidden",padding:"0",margin:"0"}).children().css({"float":"left",width:M});break;case"leftLoop":case"leftMarquee":Y(),f.wrap('<div class="tempWrap" style="overflow:hidden; position:relative; width:'+y*E+'px"></div>').css({width:(h+y+J)*E,position:"relative",overflow:"hidden",padding:"0",margin:"0",left:-(J+v*b)*E}).children().css({"float":"left",width:M});break;case"topLoop":case"topMarquee":Y(),f.wrap('<div class="tempWrap" style="overflow:hidden; position:relative; height:'+y*T+'px"></div>').css({height:(h+y+J)*T,position:"relative",padding:"0",margin:"0",top:-(J+v*b)*T}).children().css({height:j})}}var X=function(e){var t=e*b;return e==d?t=h:-1==e&&h%b!=0&&(t=-h%b),t},Z=function(t){var n=function(n){for(var i=n;i<y+n;i++)t.eq(i).find("img["+p+"]").each(function(){var t=e(this);if(t.attr("src",t.attr(p)).removeAttr(p),f.find(".clone")[0])for(var n=f.children(),i=0;i<n.length;i++)n.eq(i).find("img["+p+"]").each(function(){e(this).attr(p)==t.attr("src")&&e(this).attr("src",e(this).attr(p)).removeAttr(p)})})};switch(a){case"fade":case"fold":case"top":case"left":case"slideDown":n(v*b);break;case"leftLoop":case"topLoop":n(J+X(R));break;case"leftMarquee":case"topMarquee":var i="leftMarquee"==a?f.css("left").replace("px",""):f.css("top").replace("px",""),o="leftMarquee"==a?E:T,r=J;if(i%o!=0){var s=Math.abs(i/o^0);r=1==v?J+s:J+s-1}n(r)}},K=function(e){if(!_||L!=v||e||B){if(B?v>=1?v=1:v<=0&&(v=0):(R=v,v>=d?v=0:v<0&&(v=d-1)),U(),null!=p&&Z(f.children()),m[0]&&(n=m.eq(v),null!=p&&Z(m),"slideDown"==a?(m.not(n).stop(!0,!0).slideUp(g),n.slideDown(g,A,function(){f[0]||z()})):(m.not(n).stop(!0,!0).hide(),n.animate({opacity:"show"},g,function(){f[0]||z()}))),h>=y)switch(a){case"fade":f.children().stop(!0,!0).eq(v).animate({opacity:"show"},g,A,function(){z()}).siblings().hide();break;case"fold":f.children().stop(!0,!0).eq(v).animate({opacity:"show"},g,A,function(){z()}).siblings().animate({opacity:"hide"},g,A);break;case"top":f.stop(!0,!1).animate({top:-v*b*T},g,A,function(){z()});break;case"left":f.stop(!0,!1).animate({left:-v*b*E},g,A,function(){z()});break;case"leftLoop":var t=R;f.stop(!0,!0).animate({left:-(X(R)+J)*E},g,A,function(){t<=-1?f.css("left",-(J+(d-1)*b)*E):t>=d&&f.css("left",-J*E),z()});break;case"topLoop":var t=R;f.stop(!0,!0).animate({top:-(X(R)+J)*T},g,A,function(){t<=-1?f.css("top",-(J+(d-1)*b)*T):t>=d&&f.css("top",-J*T),z()});break;case"leftMarquee":var i=f.css("left").replace("px","");0==v?f.animate({left:++i},0,function(){f.css("left").replace("px","")>=0&&f.css("left",-h*E)}):f.animate({left:--i},0,function(){f.css("left").replace("px","")<=-(h+J)*E&&f.css("left",-J*E)});break;case"topMarquee":var o=f.css("top").replace("px","");0==v?f.animate({top:++o},0,function(){f.css("top").replace("px","")>=0&&f.css("top",-h*T)}):f.animate({top:--o},0,function(){f.css("top").replace("px","")<=-(h+J)*T&&f.css("top",-J*T)})}u.removeClass(F).eq(v).addClass(F),L=v,S||(s.removeClass("nextStop"),r.removeClass("prevStop"),0==v&&r.addClass("prevStop"),v==d-1&&s.addClass("nextStop")),c.html("<span>"+(v+1)+"</span>/"+d)}};_&&K(!0),I&&o.hover(function(){clearTimeout(P)},function(){P=setTimeout(function(){v=D,_?K():"slideDown"==a?n.slideUp(g,Q):n.animate({opacity:"hide"},g,Q),L=v},300)});var ee=function(e){O=setInterval(function(){k?v--:v++,K()},e||w)},te=function(e){O=setInterval(K,e||w)},ne=function(){x||(clearInterval(O),ee())},ie=function(){(S||v!=d-1)&&(v++,K(),B||ne())},oe=function(){(S||0!=v)&&(v--,K(),B||ne())},ae=function(){clearInterval(O),B?te():ee(),l.removeClass("pauseState")},re=function(){clearInterval(O),l.addClass("pauseState")};if($?B?(k?v--:v++,te(),x&&f.hover(re,ae)):(ee(),x&&o.hover(re,ae)):(B&&(k?v--:v++),l.addClass("pauseState")),l.click(function(){l.hasClass("pauseState")?ae():re()}),"mouseover"==i.trigger?u.hover(function(){var e=u.index(this);q=setTimeout(function(){v=e,K(),ne()},i.triggerTime)},function(){clearTimeout(q)}):u.click(function(){v=u.index(this),K(),ne()}),B){if(s.mousedown(ie),r.mousedown(oe),S){var se,ce=function(){se=setTimeout(function(){clearInterval(O),te(w/10^0)},150)},le=function(){clearTimeout(se),clearInterval(O),te()};s.mousedown(ce),s.mouseup(le),r.mousedown(ce),r.mouseup(le)}"mouseover"==i.trigger&&(s.hover(ie,function(){}),r.hover(oe,function(){}))}else s.click(ie),r.click(oe)})}}(jQuery),jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,n,i,o){return jQuery.easing[jQuery.easing.def](e,t,n,i,o)},easeInQuad:function(e,t,n,i,o){return i*(t/=o)*t+n},easeOutQuad:function(e,t,n,i,o){return-i*(t/=o)*(t-2)+n},easeInOutQuad:function(e,t,n,i,o){return(t/=o/2)<1?i/2*t*t+n:-i/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,i,o){return i*(t/=o)*t*t+n},easeOutCubic:function(e,t,n,i,o){return i*((t=t/o-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,i,o){return(t/=o/2)<1?i/2*t*t*t+n:i/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,i,o){return i*(t/=o)*t*t*t+n},easeOutQuart:function(e,t,n,i,o){return-i*((t=t/o-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,i,o){return(t/=o/2)<1?i/2*t*t*t*t+n:-i/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,i,o){return i*(t/=o)*t*t*t*t+n},easeOutQuint:function(e,t,n,i,o){return i*((t=t/o-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,i,o){return(t/=o/2)<1?i/2*t*t*t*t*t+n:i/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,i,o){return-i*Math.cos(t/o*(Math.PI/2))+i+n},easeOutSine:function(e,t,n,i,o){return i*Math.sin(t/o*(Math.PI/2))+n},easeInOutSine:function(e,t,n,i,o){return-i/2*(Math.cos(Math.PI*t/o)-1)+n},easeInExpo:function(e,t,n,i,o){return 0==t?n:i*Math.pow(2,10*(t/o-1))+n},easeOutExpo:function(e,t,n,i,o){return t==o?n+i:i*(1-Math.pow(2,-10*t/o))+n},easeInOutExpo:function(e,t,n,i,o){return 0==t?n:t==o?n+i:(t/=o/2)<1?i/2*Math.pow(2,10*(t-1))+n:i/2*(2-Math.pow(2,-10*--t))+n},easeInCirc:function(e,t,n,i,o){return-i*(Math.sqrt(1-(t/=o)*t)-1)+n},
easeOutCirc:function(e,t,n,i,o){return i*Math.sqrt(1-(t=t/o-1)*t)+n},easeInOutCirc:function(e,t,n,i,o){return(t/=o/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+n:i/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,i,o){var a=1.70158,r=0,s=i;if(0==t)return n;if(1==(t/=o))return n+i;if(r||(r=.3*o),s<Math.abs(i)){s=i;var a=r/4}else var a=r/(2*Math.PI)*Math.asin(i/s);return-s*Math.pow(2,10*(t-=1))*Math.sin((t*o-a)*(2*Math.PI)/r)+n},easeOutElastic:function(e,t,n,i,o){var a=1.70158,r=0,s=i;if(0==t)return n;if(1==(t/=o))return n+i;if(r||(r=.3*o),s<Math.abs(i)){s=i;var a=r/4}else var a=r/(2*Math.PI)*Math.asin(i/s);return s*Math.pow(2,-10*t)*Math.sin((t*o-a)*(2*Math.PI)/r)+i+n},easeInOutElastic:function(e,t,n,i,o){var a=1.70158,r=0,s=i;if(0==t)return n;if(2==(t/=o/2))return n+i;if(r||(r=o*(.3*1.5)),s<Math.abs(i)){s=i;var a=r/4}else var a=r/(2*Math.PI)*Math.asin(i/s);return t<1?s*Math.pow(2,10*(t-=1))*Math.sin((t*o-a)*(2*Math.PI)/r)*-.5+n:s*Math.pow(2,-10*(t-=1))*Math.sin((t*o-a)*(2*Math.PI)/r)*.5+i+n},easeInBack:function(e,t,n,i,o,a){return a==undefined&&(a=1.70158),i*(t/=o)*t*((a+1)*t-a)+n},easeOutBack:function(e,t,n,i,o,a){return a==undefined&&(a=1.70158),i*((t=t/o-1)*t*((a+1)*t+a)+1)+n},easeInOutBack:function(e,t,n,i,o,a){return a==undefined&&(a=1.70158),(t/=o/2)<1?i/2*(t*t*((1+(a*=1.525))*t-a))+n:i/2*((t-=2)*t*((1+(a*=1.525))*t+a)+2)+n},easeInBounce:function(e,t,n,i,o){return i-jQuery.easing.easeOutBounce(e,o-t,0,i,o)+n},easeOutBounce:function(e,t,n,i,o){return(t/=o)<1/2.75?i*(7.5625*t*t)+n:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+n:i*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(e,t,n,i,o){return t<o/2?.5*jQuery.easing.easeInBounce(e,2*t,0,i,o)+n:.5*jQuery.easing.easeOutBounce(e,2*t-o,0,i,o)+.5*i+n}}),function(e){"use strict";function t(e){this._obj=e}function n(e){var n=this;new t(e)._each(function(e,t){n[e]=t})}if(void 0===e)throw new Error("Geetest requires browser environment");var i=e.document,o=e.Math,a=i.getElementsByTagName("head")[0];t.prototype={_each:function(e){var t=this._obj;for(var n in t)t.hasOwnProperty(n)&&e(n,t[n]);return this}},n.prototype={api_server:"api.geetest.com",protocol:"https://",typePath:"/gettype.php",fallback_config:{slide:{static_servers:["static.geetest.com","dn-staticdown.qbox.me"],type:"slide",slide:"/static/js/geetest.0.0.0.js"},fullpage:{static_servers:["static.geetest.com","dn-staticdown.qbox.me"],type:"fullpage",fullpage:"/static/js/fullpage.0.0.0.js"}},_get_fallback_config:function(){var e=this;return s(e.type)?e.fallback_config[e.type]:e.new_captcha?e.fallback_config.fullpage:e.fallback_config.slide},_extend:function(e){var n=this;new t(e)._each(function(e,t){n[e]=t})}};var r=function(e){return"number"==typeof e},s=function(e){return"string"==typeof e},c=function(e){return"boolean"==typeof e},l=function(e){return"object"==typeof e&&null!==e},u=function(e){return"function"==typeof e},d={},f={},h=function(){return parseInt(1e4*o.random())+(new Date).valueOf()},p=function(e,t){var n=i.createElement("script");n.charset="UTF-8",n.async=!0,n.onerror=function(){t(!0)};var o=!1;n.onload=n.onreadystatechange=function(){o||n.readyState&&"loaded"!==n.readyState&&"complete"!==n.readyState||(o=!0,setTimeout(function(){t(!1)},0))},n.src=e,a.appendChild(n)},m=function(e){return e.replace(/^https?:\/\/|\/$/g,"")},v=function(e){return e=e.replace(/\/+/g,"/"),0!==e.indexOf("/")&&(e="/"+e),e},g=function(e){if(!e)return"";var n="?";return new t(e)._each(function(e,t){(s(t)||r(t)||c(t))&&(n=n+encodeURIComponent(e)+"="+encodeURIComponent(t)+"&")}),"?"===n&&(n=""),n.replace(/&$/,"")},w=function(e,t,n,i){t=m(t);var o=v(n)+g(i);return t&&(o=e+t+o),o},b=function(e,t,n,i,o){var a=function(r){var s=w(e,t[r],n,i);p(s,function(e){e?r>=t.length-1?o(!0):a(r+1):o(!1)})};a(0)},y=function(t,n,i,o){if(l(i.getLib))return i._extend(i.getLib),void o(i);if(i.offline)return void o(i._get_fallback_config());var a="geetest_"+h();e[a]=function(t){o("success"==t.status?t.data:t.status?i._get_fallback_config():t),e[a]=undefined;try{delete e[a]}catch(e){}},b(i.protocol,t,n,{gt:i.gt,callback:a},function(e){e&&o(i._get_fallback_config())})},$=function(e,t){var n={networkError:"\u7f51\u7edc\u9519\u8bef",gtTypeError:"gt\u5b57\u6bb5\u4e0d\u662f\u5b57\u7b26\u4e32\u7c7b\u578b"};if("function"!=typeof t.onError)throw new Error(n[e]);t.onError(n[e])};(function(){return e.Geetest||i.getElementById("gt_lib")})()&&(f.slide="loaded"),e.initGeetest=function(t,i){var o=new n(t);t.https?o.protocol="https://":t.protocol||(o.protocol=e.location.protocol+"//"),l(t.getType)&&o._extend(t.getType),y([o.api_server||o.apiserver],o.typePath,o,function(t){var n=t.type,a=function(){o._extend(t),i(new e.Geetest(o))};d[n]=d[n]||[];var r=f[n]||"init";"init"===r?(f[n]="loading",d[n].push(a),b(o.protocol,t.static_servers||t.domains,t[n]||t.path,null,function(e){if(e)f[n]="fail",$("networkError",o);else{f[n]="loaded";for(var t=d[n],i=0,a=t.length;i<a;i+=1){var r=t[i];u(r)&&r()}d[n]=[]}})):"loaded"===r?a():"fail"===r?$("networkError",o):"loading"===r&&d[n].push(a)})}}(window),function(){function e(){window._hmt&&window._hmt.push(["_trackPageview",window.location.pathname+window.location.search])}function t(e){for(var t=window.location.href.split("").reverse(),n=e.split(""),i=[],o=0;o<16;o++)i.push(n[o]+(t[o]||""));return i.join("")}if(!window._hmt){var n=window.document.write;window.document.write=function(){},$.ajax({url:"//hm.baidu.com/hm.js?ef3c2beab5007fbbc75c3072658b745e",dataType:"script",cache:!0}).then(function(){window.document.write=n,$.ajax({url:"https://zz.bdstatic.com/linksubmit/push.js",dataType:"script",cache:!0})})}$(document).off("turbolinks:load",e).on("turbolinks:load",e);var i="7788abe3df9a1b5f575cb210eb8e05cc",o="//s.360.cn/so/zz.gif?url="+window.encodeURIComponent(window.location.href)+"&sid="+i+"&token="+t(i);(new Image).src=o,window.initSlider=function(e,t,n,i,o){function a(){var e=r.data("nivo:vars"),t=e.currentImage.data("iii");if(t){var n=t.split(/\s*,\s*/,5),i=+n[0],o=+n[1],a=+n[2],s=+n[3],c=n[4];d.css({top:o,left:i,width:a,height:s,"background-image":"url("+c+")"}),d.removeClass("hidden")}}var r=$('<div class="nivoSlider"></div>');r.appendTo($(e).empty());var s;for(s=0;s<Math.min(i.length,n);s++)r.append(i[s]);n-=s;for(var c=o.length;c>0;){var l=Math.floor(Math.random()*c);c--;var u=o[c];o[c]=o[l],o[l]=u}for(s=0;s<Math.min(o.length,n);s++)r.append(o[s]);var d=$('<div class="image-in-image hidden" />').insertAfter(r);r.nivoSlider({effect:"fold",pauseTime:t,beforeChange:function(){d.addClass("hidden")},afterChange:a}),a()}}();